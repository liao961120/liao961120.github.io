<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Web Page on Yongfu's Blog</title><link>https://yongfu.name/tags/web-page/</link><description>Recent content in Web Page on Yongfu's Blog</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Sun, 06 Jun 2021 00:00:00 +0000</lastBuildDate><atom:link href="https://yongfu.name/tags/web-page/feed.xml" rel="self" type="application/rss+xml"/><item><title>A Timer for Interval Training</title><link>https://yongfu.name/2021/06/06/interval-timer/</link><pubDate>Sun, 06 Jun 2021 00:00:00 +0000</pubDate><guid>https://yongfu.name/2021/06/06/interval-timer/</guid><description>&lt;p>Last year I have tried home workouts since the gym was shutdown for about four months. During that time, I realized that it is harder to maintain the challenge and effectiveness of the workout since few training equipments are available at home. Later I found out that &lt;strong>time&lt;/strong> is a crucial factor to increase the challenge and effectiveness of the training. By incorporating interval training to my workout schedule, I started to see the gains!
During this period, I used &lt;a href="https://intervaltimer.com">intervaltimer.com&lt;/a> to create my own interval training timer. This website (mobile app also available) allows users to build and save their own training timer. It is great, but I&amp;rsquo;m a bit upset with its user interface since it imposes many limitations on how a user can customize the intervals of the timer. In addition, some of the features on the website is locked in the associated mobile app. This has led me to the idea of creating an open source alternative to &lt;a href="https://intervaltimer.com">intervaltimer.com&lt;/a>.&lt;/p>
&lt;p>Recently, the outbreak of COVID-19 in Taiwan spare me quite a lot of time, and I have spent some of the time picking up JavaScript. Last Friday (Jun 4), I was randomly browsing the &lt;a href="https://developer.mozilla.org/en-US/docs/Web/API/HTML_Drag_and_Drop_API">HTML Drag and Drop API&lt;/a>. This reminded me of the interval training timer. After watching a &lt;a href="https://www.youtube.com/watch?v=jfYWwQrtzzY">video&lt;/a> about building sortable drag and drop elements with vanilla JavaScript, I decided that it is time to carry out the project of building an interval timer.&lt;/p>
&lt;p>It has been &lt;a href="https://yongfu.name/2019/07/06/svg2png">almost two years&lt;/a> since I wrote an app in vanilla JavaScript&lt;sup id="fnref:1">&lt;a href="#fn:1" class="footnote-ref" role="doc-noteref">1&lt;/a>&lt;/sup>. These days, I have been creating apps with JavaScript frameworks like Vue. It is great, but working with vanilla JavaScript is also pleasuring. Switching back and forth between two different ways of creating web apps is joyful, as it gives you the opportunity to think about programming in two quite distinct ways!&lt;/p>
&lt;h2 id="draggable-interval-timer">Draggable Interval Timer&lt;/h2>
&lt;p>To keep the timer minimalist&lt;sup id="fnref:2">&lt;a href="#fn:2" class="footnote-ref" role="doc-noteref">2&lt;/a>&lt;/sup>, I wrote it in vanilla JavaScript, HTML &amp;amp; CSS (no server required of course). The most important feature of this timer is its &lt;strong>dragging&lt;/strong> functionality, which gives users the flexibility of sorting the exercise blocks at will. Another useful feature is that custom timers created by the user are sharable through URLs. This makes up for the unavailability of the drag and drop API on touch screen devices (e.g. mobile phones) since a user can just create a timer on the PC/laptop and access the timer with a link on her mobile phone. Here is an &lt;a href="https://timer.yongfu.name/?data=_LSB__LB_%22name%22_CL_%22Get%20Ready%22_CM_%22time%22_CL_%225%22_CM_%22color%22_CL_%22_PD_38cdff%22_RB__CM__LB_%22name%22_CL_%22Sit%20up%22_CM_%22time%22_CL_%2245%22_CM_%22color%22_CL_%22_PD_ff0000%22_RB__CM__LB_%22name%22_CL_%22Rest%22_CM_%22time%22_CL_%2215%22_CM_%22color%22_CL_%22_PD_00d423%22_RB__CM__LB_%22name%22_CL_%22Push%20up%22_CM_%22time%22_CL_%2245%22_CM_%22color%22_CL_%22_PD_F76B00%22_RB__CM__LB_%22name%22_CL_%22Rest%22_CM_%22time%22_CL_%2215%22_CM_%22color%22_CL_%22_PD_00d423%22_RB__CM__LB_%22name%22_CL_%22Sit%20up%22_CM_%22time%22_CL_%2245%22_CM_%22color%22_CL_%22_PD_ff0000%22_RB__CM__LB_%22name%22_CL_%22Rest%22_CM_%22time%22_CL_%2215%22_CM_%22color%22_CL_%22_PD_00d423%22_RB__CM__LB_%22name%22_CL_%22Push%20up%22_CM_%22time%22_CL_%2245%22_CM_%22color%22_CL_%22_PD_F76B00%22_RB__CM__LB_%22name%22_CL_%22Rest%22_CM_%22time%22_CL_%2215%22_CM_%22color%22_CL_%22_PD_00d423%22_RB__CM__LB_%22name%22_CL_%22Sit%20up%22_CM_%22time%22_CL_%2245%22_CM_%22color%22_CL_%22_PD_ff0000%22_RB__RSB_">example&lt;/a>!&lt;/p>
&lt;p>
&lt;figure>
&lt;img src="https://raw.githubusercontent.com/liao961120/draggableTimer/main/demo/demo.gif" alt="Draggable Interval Timer">
&lt;figcaption>Draggable Interval Timer&lt;/figcaption>
&lt;/figure>
&lt;/p>
&lt;p>The timer is available at &lt;a href="https://timer.yongfu.name">timer.yongfu.name&lt;/a> and the source code is on &lt;a href="https://github.com/liao961120/draggableTimer">GitHub&lt;/a>. I&amp;rsquo;m looking forward to seeing your custom interval timers!&lt;/p>
&lt;div class="footnotes" role="doc-endnotes">
&lt;hr>
&lt;ol>
&lt;li id="fn:1">
&lt;p>This is when I started to learn JavaScript &lt;strong>seriously&lt;/strong>, thanks to &lt;a href="https://cs50.harvard.edu/web/2018/">CS50&amp;rsquo;s Web Programming with Python and JavaScript&lt;/a>.&amp;#160;&lt;a href="#fnref:1" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;li id="fn:2">
&lt;p>With more functionalities comes more limitations, this is what has happened with &lt;a href="https://intervaltimer.com">intervaltimer.com&lt;/a>, I think.&amp;#160;&lt;a href="#fnref:2" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;/div></description><category>JavaScript</category><category>Web Page</category></item><item><title>Convert SVGs to PNGs with Your Web Browser</title><link>https://yongfu.name/2019/07/06/svg2png/</link><pubDate>Sat, 06 Jul 2019 00:00:00 +0000</pubDate><guid>https://yongfu.name/2019/07/06/svg2png/</guid><description>&lt;p>I recently found a great &lt;a href="https://courses.edx.org/courses/course-v1:HarvardX+CS50W+Web/course/">course about web programming&lt;/a> on edX and learned a lot from it (I knew little about back-end web development and were unfamiliar with JavaScript). When I learned that it is possible to &lt;a href="https://video.cs50.net/web/2018/spring/lectures/6?t=1h35m5s">&lt;em>draw&lt;/em> an SVG with the mouse in the browser&lt;/a>, some interesting stuff came up to me &amp;mdash; &lt;em>can I download the SVG after I finished drawing?&lt;/em> I found some solutions on the web pretty easily. Meanwhile, another interesting idea came upon &amp;mdash; &lt;em>can I use the browser to convert local SVG images to PNG images?&lt;/em>
It turns out that this is completely possible with pure JavaScript. I started to realize how mighty web browsers are.&lt;/p>
&lt;p>As an exercise to familiarize myself with JavaScript, I implemented this idea in a simple static web page, &lt;a href="https://svg2png.yongfu.name">svg2png&lt;/a>, which can convert multiple SVG images to PNG images (with options to set the resolution of the PNGs).&lt;/p>
&lt;h2 id="no-server-zero-dependencies">No Server, Zero Dependencies&lt;/h2>
&lt;p>One good thing about &lt;a href="https://svg2png.yongfu.name">svg2png&lt;/a> is that the computations are all done in the browser. So compared to other online services (e.g. &lt;a href="https://svgtopng.com/">this&lt;/a>), there are no file upload limits. Also, &lt;a href="https://svg2png.yongfu.name">svg2png&lt;/a> lives on the web, so there is no need to download any thing (instead of a modern browser) before using it.&lt;/p>
&lt;h2 id="how-it-works">How It Works?&lt;/h2>
&lt;p>I used HTML5&amp;rsquo;s &lt;code>&amp;lt;input type='file' multiple&amp;gt;&lt;/code> to let users upload their SVGs. After that, the files are converted into &lt;a href="https://developer.mozilla.org/zh-TW/docs/Web/API/URL/createObjectURL">object URL&lt;/a>s. This allows me to load the SVG images (invisibly) with &lt;code>&amp;lt;img src=objectURL&amp;gt;&lt;/code>, so I can get the information of these images (height and width).&lt;/p>
&lt;p>The second step is to render the SVG on &lt;a href="https://www.w3schools.com/html/html5_canvas.asp">Canvas&lt;/a> with the &lt;a href="https://github.com/canvg/canvg">canvg&lt;/a> library in order to convert it to PNG later (using &lt;a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement/toBlob">&lt;code>canvas.toBlob()&lt;/code>&lt;/a>).&lt;/p>
&lt;p>The trick to adjust the DPI of the output PNG is by scaling the height and width of the canvas, which is handily provided by the &lt;a href="https://github.com/canvg/canvg#usage-on-the-browser">&lt;code>scaleWidth&lt;/code> and &lt;code>scaleHeight&lt;/code> options in &lt;code>canvg()&lt;/code>&lt;/a>. But since I have no way to get the size information of the original image directly from the File object retrieved from &lt;code>&amp;lt;input type='file'&amp;gt;&lt;/code>, I have to load the SVG images with the &lt;code>&amp;lt;img&amp;gt;&lt;/code> tags first.&lt;/p>
&lt;p>The source code of this simple project can be found &lt;a href="https://github.com/liao961120/svg2png">here&lt;/a> on GitHub.&lt;/p></description><category>JavaScript</category><category>Web Page</category></item><item><title>Visualizing Language Loss in Taiwan</title><link>https://yongfu.name/2019/02/17/visualize-language-loss/</link><pubDate>Sun, 17 Feb 2019 00:00:00 +0000</pubDate><guid>https://yongfu.name/2019/02/17/visualize-language-loss/</guid><description>
&lt;p>&lt;a href="https://twlangsurvey.github.io">Taiwan Language Survey&lt;/a> is a small project I worked on during May to June in 2018. The idea was to create a survey that &lt;strong>continuously&lt;/strong> collects data and a web page that visualizes the collected data. The web page is updated weekly using &lt;a href="https://travis-ci.org/twLangSurvey/twLangSurvey.github.io">Travis-CI&lt;/a>.&lt;/p>
&lt;p>The main purpose of this survey is to raise public awareness of &lt;strong>language loss&lt;/strong> in Taiwan. Hence, the survey is designed to collect data that can provide valuable information about language loss, for example, some questions were asked to gain insight about the change of linguistic competence acoss generations in a family (i.e. across the subject’s parents, the subject, and the subject’s children). In addition to changes within family, information about the age of the subjects is also colleceted, meaning that we can see how linguistic competence changes among diffrent age groups of subjects in a community, i.e. is a language becoming more dominant or entering the dying process?&lt;/p>
&lt;p>Visualization is a powerful tool to capture how linguistic competences of different langauges are changing. But creating visualizations necessitates creativity – how can language loss be visualized? Below, I illustrate one of the methods I created for visualizing language loss – a visaulization inspired by the &lt;a href="https://en.wikipedia.org/wiki/Population_pyramid">age-sex pyramid&lt;/a>.&lt;/p>
&lt;div id="age-sex-pyramid-of-language" class="section level2">
&lt;h2>Age-Sex Pyramid of Language&lt;/h2>
&lt;p>The age-sex pyramid is used to visualize the population structure of a community. The vertical axis indicates the age and each horizontal bar represents an age group. The horizontal axis indicates the population size of male or female of a particular age group.&lt;/p>
&lt;p>The age-sex pyramid is a great tool to visualize the population structure since the ‘shape’ of the pyramid gives readers a lot information. For example, an ‘expansive pyramid’ has longer bars at the bottom of the pyramid, which indicates the population is young and growing. A ‘stationary pyramid’ looks like a rectangular bar, indicating the population sizes of different age groups are about the same. A ‘constructive’ pyramid indicates a shrinking population, which is narrowed at the bottom.&lt;/p>
&lt;p>Similarly, a &lt;strong>modified&lt;/strong> version of the age-sex pyramid, which I’ll call the ‘&lt;strong>age-sex pyramid of language&lt;/strong>’, can be used to visualize the population structure of a language and predicts the language’s &lt;strong>vitality&lt;/strong>. Instead of visualizing population size, the age-sex pyramid of language visualizes the &lt;strong>average fluency of a language&lt;/strong> on the horizontal axis.&lt;/p>
&lt;div class="figure">&lt;span id="fig:tw-pyramid">&lt;/span>
&lt;img src="https://twlangsurvey.github.io/out_graph/Tw_pyramid.png" alt="An age-sex pyramid of Taiwanese. The red bars on the left indicates females of different age groups and the blue bars on the right indicates males. The average fluency (values on the horizontal axis) is calculated from a six-point scale (0-5) on Taiwanese fluency." width="70%" />
&lt;p class="caption">
Figure 1: An age-sex pyramid of Taiwanese. The red bars on the left indicates females of different age groups and the blue bars on the right indicates males. The average fluency (values on the horizontal axis) is calculated from a six-point scale (0-5) on Taiwanese fluency.
&lt;/p>
&lt;/div>
&lt;p>As shown in Figure &lt;a href="#fig:tw-pyramid">1&lt;/a>, the shape of the age-sex pyramid of &lt;a href="https://en.wikipedia.org/wiki/Taiwanese_Hokkien">Taiwanese&lt;/a> in Taiwan&lt;a href="#fn1" class="footnote-ref" id="fnref1">&lt;sup>1&lt;/sup>&lt;/a> is an ‘&lt;strong>inverted triangle&lt;/strong>’, which is almost never seen in the conventional population pyramid. However, this inverted triangular shape is expected to appear quite often, since it indicates an ongoing language loss in a community.&lt;/p>
&lt;table>
&lt;thead>
&lt;tr class="header">
&lt;th>&lt;strong>Vitality of Language&lt;/strong>&lt;/th>
&lt;th>&lt;strong>Shape of Pyramid&lt;/strong>&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr class="odd">
&lt;td>Shrinking and Dying&lt;/td>
&lt;td>Inverted Triangle&lt;/td>
&lt;/tr>
&lt;tr class="even">
&lt;td>Growing&lt;/td>
&lt;td>Triangle&lt;/td>
&lt;/tr>
&lt;tr class="odd">
&lt;td>Stable&lt;/td>
&lt;td>Rectangular Bar&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;/div>
&lt;div id="drawing-age-sex-pyramid-with-ggplot2" class="section level2">
&lt;h2>Drawing Age-Sex Pyramid with ggplot2&lt;/h2>
&lt;p>As complex as it might seem, an age-sex pyramid created with ggplot2 is actually a (modified) bar chart. I learned this on &lt;a href="https://stackoverflow.com/a/36804394">stackoverflow&lt;/a>, and the trick is&lt;/p>
&lt;ol style="list-style-type: decimal">
&lt;li>Use &lt;code>ifelse&lt;/code> to flip the value (here, population size) according to the gender of the age group&lt;/li>
&lt;li>Use &lt;code>geom_bar(stat = &amp;quot;identity&amp;quot;)&lt;/code> to let the heights of the bars represent values in the data frame, i.e. the value given to &lt;code>y&lt;/code>&lt;/li>
&lt;li>Use &lt;code>coord_flip()&lt;/code> to make the bars horizontal&lt;/li>
&lt;/ol>
&lt;pre class="language-r">&lt;code class="language-r">&lt;span class="kw">set.seed&lt;/span>(&lt;span class="dv">1&lt;/span>)
df0 &amp;lt;-&lt;span class="st"> &lt;/span>tibble&lt;span class="op">::&lt;/span>&lt;span class="kw">tibble&lt;/span>(
&lt;span class="dt">Age =&lt;/span> &lt;span class="kw">rep&lt;/span>(&lt;span class="kw">c&lt;/span>(&lt;span class="st">&amp;#39;10-19&amp;#39;&lt;/span>, &lt;span class="st">&amp;#39;20-29&amp;#39;&lt;/span>, &lt;span class="st">&amp;#39;30-39&amp;#39;&lt;/span>), &lt;span class="dv">2&lt;/span>),
&lt;span class="dt">Gender =&lt;/span> &lt;span class="kw">rep&lt;/span>(&lt;span class="kw">c&lt;/span>(&lt;span class="st">&amp;#39;Female&amp;#39;&lt;/span>, &lt;span class="st">&amp;#39;Male&amp;#39;&lt;/span>), &lt;span class="dt">each =&lt;/span> &lt;span class="dv">3&lt;/span>),
&lt;span class="dt">PopSize =&lt;/span> &lt;span class="kw">sample&lt;/span>(&lt;span class="dv">0&lt;/span>&lt;span class="op">:&lt;/span>&lt;span class="dv">100&lt;/span>, &lt;span class="dt">size =&lt;/span> &lt;span class="dv">6&lt;/span>, &lt;span class="dt">replace =&lt;/span> T)
)
df0&lt;/code>&lt;/pre>
&lt;div class="kable-table">
&lt;table>
&lt;thead>
&lt;tr class="header">
&lt;th align="left">Age&lt;/th>
&lt;th align="left">Gender&lt;/th>
&lt;th align="right">PopSize&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr class="odd">
&lt;td align="left">10-19&lt;/td>
&lt;td align="left">Female&lt;/td>
&lt;td align="right">26&lt;/td>
&lt;/tr>
&lt;tr class="even">
&lt;td align="left">20-29&lt;/td>
&lt;td align="left">Female&lt;/td>
&lt;td align="right">37&lt;/td>
&lt;/tr>
&lt;tr class="odd">
&lt;td align="left">30-39&lt;/td>
&lt;td align="left">Female&lt;/td>
&lt;td align="right">57&lt;/td>
&lt;/tr>
&lt;tr class="even">
&lt;td align="left">10-19&lt;/td>
&lt;td align="left">Male&lt;/td>
&lt;td align="right">91&lt;/td>
&lt;/tr>
&lt;tr class="odd">
&lt;td align="left">20-29&lt;/td>
&lt;td align="left">Male&lt;/td>
&lt;td align="right">20&lt;/td>
&lt;/tr>
&lt;tr class="even">
&lt;td align="left">30-39&lt;/td>
&lt;td align="left">Male&lt;/td>
&lt;td align="right">90&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;/div>
&lt;pre class="language-r">&lt;code class="language-r">&lt;span class="kw">library&lt;/span>(ggplot2)
pl &amp;lt;-&lt;span class="st"> &lt;/span>&lt;span class="kw">ggplot&lt;/span>(df0, &lt;span class="kw">aes&lt;/span>(&lt;span class="dt">x =&lt;/span> Age,
&lt;span class="dt">y =&lt;/span> &lt;span class="kw">ifelse&lt;/span>(Gender &lt;span class="op">==&lt;/span>&lt;span class="st"> &amp;#39;Male&amp;#39;&lt;/span>, PopSize, &lt;span class="op">-&lt;/span>PopSize),
&lt;span class="dt">fill =&lt;/span> Gender)) &lt;span class="op">+&lt;/span>
&lt;span class="st"> &lt;/span>&lt;span class="kw">geom_bar&lt;/span>(&lt;span class="dt">stat =&lt;/span> &lt;span class="st">&amp;#39;identity&amp;#39;&lt;/span>) &lt;span class="op">+&lt;/span>
&lt;span class="st"> &lt;/span>&lt;span class="kw">coord_flip&lt;/span>()
pl&lt;/code>&lt;/pre>
&lt;p>&lt;img src="https://img.yongfu.name/assets/visualize-language-loss/unnamed-chunk-1-1.png" width="70%" />&lt;/p>
&lt;p>To center the plot (i.e. to make the point where population size is zero at the center of the plot), we have to scale the axis of ‘population size’ (&lt;code>y&lt;/code>) with &lt;code>scale_y_continuous&lt;/code>:&lt;/p>
&lt;pre class="language-r">&lt;code class="language-r">pl &lt;span class="op">+&lt;/span>&lt;span class="st"> &lt;/span>&lt;span class="kw">scale_y_continuous&lt;/span>(&lt;span class="dt">limits =&lt;/span> &lt;span class="kw">c&lt;/span>(&lt;span class="op">-&lt;/span>&lt;span class="dv">100&lt;/span>, &lt;span class="dv">100&lt;/span>),
&lt;span class="dt">breaks =&lt;/span> &lt;span class="kw">seq&lt;/span>(&lt;span class="op">-&lt;/span>&lt;span class="dv">100&lt;/span>, &lt;span class="dv">100&lt;/span>, &lt;span class="dv">25&lt;/span>),
&lt;span class="dt">labels =&lt;/span> abs) &lt;span class="op">+&lt;/span>
&lt;span class="st"> &lt;/span>&lt;span class="kw">labs&lt;/span>(&lt;span class="dt">y =&lt;/span> &lt;span class="st">&amp;#39;Population Size&amp;#39;&lt;/span>)&lt;/code>&lt;/pre>
&lt;p>&lt;img src="https://img.yongfu.name/assets/visualize-language-loss/unnamed-chunk-2-1.png" width="70%" />&lt;/p>
&lt;p>where &lt;code>abs&lt;/code> in &lt;code>labels&lt;/code> is the function &lt;code>abs()&lt;/code>. By default, &lt;code>ggplot2&lt;/code> pass the value given in &lt;code>breaks&lt;/code> to the the function specified in &lt;code>labels&lt;/code>.&lt;/p>
&lt;/div>
&lt;div id="visualizing-language-loss" class="section level2">
&lt;h2>Visualizing Language Loss&lt;/h2>
&lt;p>To create an age-sex pyramid of language, the data structure needed is exactly the same as the one above, except the variable, &lt;code>PopSize&lt;/code>, is replaced by ‘average fluency’ of a language. But since most people in Taiwan can speak more than one language (e.g. Mandarin-Taiwanese, Mandarin-Taiwanese-Hakka, Mandarin-English, etc.), the real data from the survey is a bit more complex Basically, the data structure needed to draw an age-sex pyramid of language looks like:&lt;/p>
&lt;table>
&lt;thead>
&lt;tr class="header">
&lt;th>&lt;strong>Gender&lt;/strong>&lt;/th>
&lt;th>&lt;strong>Ethnicity&lt;/strong>&lt;/th>
&lt;th>&lt;strong>Age Group&lt;/strong>&lt;/th>
&lt;th>&lt;strong>Avg. Fluency&lt;/strong>&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr class="odd">
&lt;td>female&lt;/td>
&lt;td>Mandarin&lt;/td>
&lt;td>20-24&lt;/td>
&lt;td>4.53&lt;/td>
&lt;/tr>
&lt;tr class="even">
&lt;td>male&lt;/td>
&lt;td>Taiwanese&lt;/td>
&lt;td>20-24&lt;/td>
&lt;td>2.78&lt;/td>
&lt;/tr>
&lt;tr class="odd">
&lt;td>…&lt;/td>
&lt;td>…&lt;/td>
&lt;td>…&lt;/td>
&lt;td>…&lt;/td>
&lt;/tr>
&lt;tr class="even">
&lt;td>female&lt;/td>
&lt;td>Hakka&lt;/td>
&lt;td>25-29&lt;/td>
&lt;td>2.23&lt;/td>
&lt;/tr>
&lt;tr class="odd">
&lt;td>male&lt;/td>
&lt;td>Taiwanese&lt;/td>
&lt;td>35-39&lt;/td>
&lt;td>3.57&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;div id="preparation-of-data" class="section level3">
&lt;h3>Preparation of Data&lt;/h3>
&lt;p>The raw data of &lt;a href="https://twlangsurvey.github.io/">Taiwan Language Survey&lt;/a> can be retrieved &lt;a href="https://docs.google.com/spreadsheets/d/1NOJ9O_zBR6s-9e1fFGVcRaBjn5qQuVB9ZeSebhBctoM/edit?usp=sharing">here&lt;/a>. The survey and raw data is in traditional Chinese. I’ll skip the step of cleaning raw data (e.g., turn variable names to English) and used the cleaned data &lt;code>survey.rds&lt;/code> instead.&lt;/p>
&lt;pre class="language-r">&lt;code class="language-r">temp &amp;lt;-&lt;span class="st"> &lt;/span>&lt;span class="kw">tempfile&lt;/span>()
&lt;span class="kw">download.file&lt;/span>(&lt;span class="st">&amp;#39;https://raw.githubusercontent.com/twLangSurvey/twLangSurvey.github.io/master/data/survey.rds&amp;#39;&lt;/span>, &lt;span class="dt">destfile =&lt;/span> temp)
data &amp;lt;-&lt;span class="st"> &lt;/span>readr&lt;span class="op">::&lt;/span>&lt;span class="kw">read_rds&lt;/span>(temp)
&lt;span class="kw">head&lt;/span>(data, &lt;span class="dv">3&lt;/span>)&lt;/code>&lt;/pre>
&lt;div class="kable-table">
&lt;table>
&lt;thead>
&lt;tr class="header">
&lt;th align="left">date&lt;/th>
&lt;th align="left">curr_resid&lt;/th>
&lt;th align="right">curr_resid_since&lt;/th>
&lt;th align="left">settle_5yy&lt;/th>
&lt;th align="left">home_town&lt;/th>
&lt;th align="left">gender&lt;/th>
&lt;th align="right">age&lt;/th>
&lt;th align="right">kid_num&lt;/th>
&lt;th align="left">edu_level&lt;/th>
&lt;th align="left">work&lt;/th>
&lt;th align="left">income&lt;/th>
&lt;th align="left">work_hr&lt;/th>
&lt;th align="left">tribe&lt;/th>
&lt;th align="right">Mand_listen&lt;/th>
&lt;th align="right">Mand_speak&lt;/th>
&lt;th align="right">Tw_listen&lt;/th>
&lt;th align="right">Tw_speak&lt;/th>
&lt;th align="right">Hak_listen&lt;/th>
&lt;th align="right">Hak_speak&lt;/th>
&lt;th align="right">Ind_listen&lt;/th>
&lt;th align="right">Ind_speak&lt;/th>
&lt;th align="right">SEA_listen&lt;/th>
&lt;th align="right">SEA_speak&lt;/th>
&lt;th align="right">Eng_listen&lt;/th>
&lt;th align="right">Eng_speak&lt;/th>
&lt;th align="left">first_lang&lt;/th>
&lt;th align="left">when_Mand&lt;/th>
&lt;th align="left">when_Tw&lt;/th>
&lt;th align="left">when_Hak&lt;/th>
&lt;th align="left">when_Ind&lt;/th>
&lt;th align="left">when_SEA&lt;/th>
&lt;th align="left">when_Eng&lt;/th>
&lt;th align="left">m_guard_identity&lt;/th>
&lt;th align="left">f_guard_identity&lt;/th>
&lt;th align="right">dad_Mand_speak&lt;/th>
&lt;th align="right">dad_Tw_speak&lt;/th>
&lt;th align="right">dad_Hak_speak&lt;/th>
&lt;th align="right">dad_Eng_speak&lt;/th>
&lt;th align="right">dad_Ind_speak&lt;/th>
&lt;th align="right">dad_SEA_speak&lt;/th>
&lt;th align="right">mom_Mand_speak&lt;/th>
&lt;th align="right">mom_Tw_speak&lt;/th>
&lt;th align="right">mom_Hak_speak&lt;/th>
&lt;th align="right">mom_Eng_speak&lt;/th>
&lt;th align="right">mom_Ind_speak&lt;/th>
&lt;th align="right">mom_SEA_speak&lt;/th>
&lt;th align="left">dad_mom_Mand_fq&lt;/th>
&lt;th align="left">dad_mom_Tw_fq&lt;/th>
&lt;th align="left">dad_mom_Hak_fq&lt;/th>
&lt;th align="left">dad_mom_Ind_fq&lt;/th>
&lt;th align="left">dad_mom_SEA_fq&lt;/th>
&lt;th align="left">dad_mom_Other_fq&lt;/th>
&lt;th align="left">me_dad_Mand_fq&lt;/th>
&lt;th align="left">me_dad_Tw_fq&lt;/th>
&lt;th align="left">me_dad_Hak_fq&lt;/th>
&lt;th align="left">me_dad_Ind_fq&lt;/th>
&lt;th align="left">me_dad_SEA_fq&lt;/th>
&lt;th align="left">me_dad_Other_fq&lt;/th>
&lt;th align="left">me_mom_Mand_fq&lt;/th>
&lt;th align="left">me_mom_Tw_fq&lt;/th>
&lt;th align="left">me_mom_Hak_fq&lt;/th>
&lt;th align="left">me_mom_Ind_fq&lt;/th>
&lt;th align="left">me_mom_SEA_fq&lt;/th>
&lt;th align="left">me_mom_Other_fq&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr class="odd">
&lt;td align="left">2018-06-12&lt;/td>
&lt;td align="left">106&lt;/td>
&lt;td align="right">1996&lt;/td>
&lt;td align="left">是&lt;/td>
&lt;td align="left">428&lt;/td>
&lt;td align="left">女&lt;/td>
&lt;td align="right">56&lt;/td>
&lt;td align="right">2&lt;/td>
&lt;td align="left">大學&lt;/td>
&lt;td align="left">金融業&lt;/td>
&lt;td align="left">10萬以上&lt;/td>
&lt;td align="left">45 - 50 小時&lt;/td>
&lt;td align="left">不具原住民身份&lt;/td>
&lt;td align="right">5&lt;/td>
&lt;td align="right">4&lt;/td>
&lt;td align="right">3&lt;/td>
&lt;td align="right">2&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">2&lt;/td>
&lt;td align="right">1&lt;/td>
&lt;td align="left">華語&lt;/td>
&lt;td align="left">7歲前&lt;/td>
&lt;td align="left">7歲前&lt;/td>
&lt;td align="left">未學會&lt;/td>
&lt;td align="left">未學會&lt;/td>
&lt;td align="left">未學會&lt;/td>
&lt;td align="left">12-15歲&lt;/td>
&lt;td align="left">父親&lt;/td>
&lt;td align="left">母親&lt;/td>
&lt;td align="right">3&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">3&lt;/td>
&lt;td align="right">4&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="left">幾乎全用&lt;/td>
&lt;td align="left">幾乎不用&lt;/td>
&lt;td align="left">幾乎不用&lt;/td>
&lt;td align="left">幾乎不用&lt;/td>
&lt;td align="left">幾乎不用&lt;/td>
&lt;td align="left">幾乎不用&lt;/td>
&lt;td align="left">幾乎全用&lt;/td>
&lt;td align="left">幾乎不用&lt;/td>
&lt;td align="left">幾乎不用&lt;/td>
&lt;td align="left">幾乎不用&lt;/td>
&lt;td align="left">幾乎不用&lt;/td>
&lt;td align="left">幾乎不用&lt;/td>
&lt;td align="left">約一半&lt;/td>
&lt;td align="left">多數使用&lt;/td>
&lt;td align="left">幾乎不用&lt;/td>
&lt;td align="left">幾乎不用&lt;/td>
&lt;td align="left">幾乎不用&lt;/td>
&lt;td align="left">幾乎不用&lt;/td>
&lt;/tr>
&lt;tr class="even">
&lt;td align="left">2018-06-13&lt;/td>
&lt;td align="left">204&lt;/td>
&lt;td align="right">2004&lt;/td>
&lt;td align="left">是&lt;/td>
&lt;td align="left">204&lt;/td>
&lt;td align="left">女&lt;/td>
&lt;td align="right">57&lt;/td>
&lt;td align="right">1&lt;/td>
&lt;td align="left">碩士&lt;/td>
&lt;td align="left">製造業&lt;/td>
&lt;td align="left">10萬以上&lt;/td>
&lt;td align="left">50 - 55 小時&lt;/td>
&lt;td align="left">不具原住民身份&lt;/td>
&lt;td align="right">5&lt;/td>
&lt;td align="right">5&lt;/td>
&lt;td align="right">5&lt;/td>
&lt;td align="right">5&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">4&lt;/td>
&lt;td align="right">4&lt;/td>
&lt;td align="left">華語&lt;/td>
&lt;td align="left">7歲前&lt;/td>
&lt;td align="left">7歲前&lt;/td>
&lt;td align="left">未學會&lt;/td>
&lt;td align="left">未學會&lt;/td>
&lt;td align="left">未學會&lt;/td>
&lt;td align="left">12-15歲&lt;/td>
&lt;td align="left">父親&lt;/td>
&lt;td align="left">母親&lt;/td>
&lt;td align="right">5&lt;/td>
&lt;td align="right">5&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">1&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">1&lt;/td>
&lt;td align="right">5&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="left">幾乎不用&lt;/td>
&lt;td align="left">多數使用&lt;/td>
&lt;td align="left">幾乎不用&lt;/td>
&lt;td align="left">幾乎不用&lt;/td>
&lt;td align="left">幾乎不用&lt;/td>
&lt;td align="left">幾乎不用&lt;/td>
&lt;td align="left">幾乎不用&lt;/td>
&lt;td align="left">多數使用&lt;/td>
&lt;td align="left">幾乎不用&lt;/td>
&lt;td align="left">幾乎不用&lt;/td>
&lt;td align="left">幾乎不用&lt;/td>
&lt;td align="left">幾乎不用&lt;/td>
&lt;td align="left">幾乎不用&lt;/td>
&lt;td align="left">多數使用&lt;/td>
&lt;td align="left">幾乎不用&lt;/td>
&lt;td align="left">幾乎不用&lt;/td>
&lt;td align="left">幾乎不用&lt;/td>
&lt;td align="left">幾乎不用&lt;/td>
&lt;/tr>
&lt;tr class="odd">
&lt;td align="left">2018-06-13&lt;/td>
&lt;td align="left">103&lt;/td>
&lt;td align="right">2013&lt;/td>
&lt;td align="left">是&lt;/td>
&lt;td align="left">100&lt;/td>
&lt;td align="left">男&lt;/td>
&lt;td align="right">37&lt;/td>
&lt;td align="right">2&lt;/td>
&lt;td align="left">大學&lt;/td>
&lt;td align="left">金融業&lt;/td>
&lt;td align="left">55,000 - 60,000&lt;/td>
&lt;td align="left">25 - 30 小時&lt;/td>
&lt;td align="left">不具原住民身份&lt;/td>
&lt;td align="right">5&lt;/td>
&lt;td align="right">5&lt;/td>
&lt;td align="right">2&lt;/td>
&lt;td align="right">1&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">3&lt;/td>
&lt;td align="right">2&lt;/td>
&lt;td align="left">華語&lt;/td>
&lt;td align="left">7歲前&lt;/td>
&lt;td align="left">未學會&lt;/td>
&lt;td align="left">未學會&lt;/td>
&lt;td align="left">未學會&lt;/td>
&lt;td align="left">未學會&lt;/td>
&lt;td align="left">7-12歲&lt;/td>
&lt;td align="left">父親&lt;/td>
&lt;td align="left">母親&lt;/td>
&lt;td align="right">5&lt;/td>
&lt;td align="right">5&lt;/td>
&lt;td align="right">5&lt;/td>
&lt;td align="right">1&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">5&lt;/td>
&lt;td align="right">3&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">4&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="left">幾乎全用&lt;/td>
&lt;td align="left">少數使用&lt;/td>
&lt;td align="left">幾乎不用&lt;/td>
&lt;td align="left">幾乎不用&lt;/td>
&lt;td align="left">幾乎不用&lt;/td>
&lt;td align="left">幾乎不用&lt;/td>
&lt;td align="left">多數使用&lt;/td>
&lt;td align="left">少數使用&lt;/td>
&lt;td align="left">幾乎不用&lt;/td>
&lt;td align="left">幾乎不用&lt;/td>
&lt;td align="left">幾乎不用&lt;/td>
&lt;td align="left">幾乎不用&lt;/td>
&lt;td align="left">幾乎全用&lt;/td>
&lt;td align="left">幾乎不用&lt;/td>
&lt;td align="left">幾乎不用&lt;/td>
&lt;td align="left">幾乎不用&lt;/td>
&lt;td align="left">幾乎不用&lt;/td>
&lt;td align="left">幾乎不用&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;/div>
&lt;p>The survey data, &lt;code>data&lt;/code>, contains 22 variables and 267 observations (subjects). I only need these variables below to create the plot I want:&lt;/p>
&lt;ul>
&lt;li>&lt;code>gender&lt;/code>: The gender of the subject&lt;/li>
&lt;li>&lt;code>age&lt;/code>: The age of the subject&lt;/li>
&lt;li>&lt;code>m_guard_identity&lt;/code>: Male guardian of the subject, should be ‘father’ in most cases&lt;/li>
&lt;li>&lt;code>f_guard_identity&lt;/code>: Female guardian of the subject, should be ‘mother’ in most cases&lt;/li>
&lt;li>&lt;code>&amp;lt;lang&amp;gt;_speak&lt;/code>: The subject’s fluency of a language. &lt;code>&amp;lt;lang&amp;gt;&lt;/code> is one of ‘Mand’ (Mandarin), ‘Tw’ (Taiwanese), ‘Hak’ (&lt;a href="https://en.wikipedia.org/wiki/Hakka_Chinese">Hakka&lt;/a>), ‘Ind’ (languages of the indigenous peoples, aka &lt;a href="https://en.wikipedia.org/wiki/Formosan_languages">Formosan languages&lt;/a>, belong to Austronesian languages), ‘SEA’ (languages from South Easth Asia), and ‘Eng’ (English)&lt;/li>
&lt;li>&lt;code>dad_&amp;lt;lang&amp;gt;_speak&lt;/code>: The subject’s male guardian’s fluency of a language. &lt;code>&amp;lt;lang&amp;gt;&lt;/code> is same as above.&lt;/li>
&lt;li>&lt;code>mom_&amp;lt;lang&amp;gt;_speak&lt;/code>: The subject’s female guardian’s fluency of a language. &lt;code>&amp;lt;lang&amp;gt;&lt;/code> is same as above.&lt;/li>
&lt;/ul>
&lt;pre class="language-r">&lt;code class="language-r">&lt;span class="kw">library&lt;/span>(dplyr)
lang &amp;lt;-&lt;span class="st"> &lt;/span>&lt;span class="kw">c&lt;/span>(&lt;span class="st">&amp;#39;Mand&amp;#39;&lt;/span>, &lt;span class="st">&amp;#39;Tw&amp;#39;&lt;/span>, &lt;span class="st">&amp;#39;Hak&amp;#39;&lt;/span>, &lt;span class="st">&amp;#39;Ind&amp;#39;&lt;/span>, &lt;span class="st">&amp;#39;SEA&amp;#39;&lt;/span>, &lt;span class="st">&amp;#39;Eng&amp;#39;&lt;/span>)
cols &amp;lt;-&lt;span class="st"> &lt;/span>&lt;span class="kw">c&lt;/span>(&lt;span class="st">&amp;#39;gender&amp;#39;&lt;/span>, &lt;span class="st">&amp;#39;age&amp;#39;&lt;/span>, &lt;span class="st">&amp;#39;m_guard_identity&amp;#39;&lt;/span>, &lt;span class="st">&amp;#39;f_guard_identity&amp;#39;&lt;/span>,
&lt;span class="kw">paste0&lt;/span>(lang, &lt;span class="st">&amp;#39;_speak&amp;#39;&lt;/span>),
&lt;span class="kw">paste0&lt;/span>(&lt;span class="st">&amp;#39;dad_&amp;#39;&lt;/span>, lang, &lt;span class="st">&amp;#39;_speak&amp;#39;&lt;/span>),
&lt;span class="kw">paste0&lt;/span>(&lt;span class="st">&amp;#39;mom_&amp;#39;&lt;/span>, lang, &lt;span class="st">&amp;#39;_speak&amp;#39;&lt;/span>)
)
data &amp;lt;-&lt;span class="st"> &lt;/span>data[, cols] &lt;span class="op">%&amp;gt;%&lt;/span>
&lt;span class="st"> &lt;/span>&lt;span class="kw">filter&lt;/span>(gender &lt;span class="op">==&lt;/span>&lt;span class="st"> &amp;#39;男&amp;#39;&lt;/span> &lt;span class="op">|&lt;/span>&lt;span class="st"> &lt;/span>gender &lt;span class="op">==&lt;/span>&lt;span class="st"> &amp;#39;女&amp;#39;&lt;/span>)&lt;/code>&lt;/pre>
&lt;p>Since some content of the survey data is in Chinese, the code below is used to translate it to English:&lt;/p>
&lt;pre class="language-r">&lt;code class="language-r">ch2eng &amp;lt;-&lt;span class="st"> &lt;/span>&lt;span class="cf">function&lt;/span>(x) {
&lt;span class="cf">if&lt;/span> (x &lt;span class="op">==&lt;/span>&lt;span class="st"> &amp;#39;男&amp;#39;&lt;/span>) &lt;span class="kw">return&lt;/span>(&lt;span class="st">&amp;#39;Male&amp;#39;&lt;/span>)
&lt;span class="cf">if&lt;/span> (x &lt;span class="op">==&lt;/span>&lt;span class="st"> &amp;#39;女&amp;#39;&lt;/span>) &lt;span class="kw">return&lt;/span>(&lt;span class="st">&amp;#39;Female&amp;#39;&lt;/span>)
&lt;span class="cf">if&lt;/span> (x &lt;span class="op">==&lt;/span>&lt;span class="st"> &amp;#39;母親&amp;#39;&lt;/span>) &lt;span class="kw">return&lt;/span>(&lt;span class="st">&amp;#39;Mother&amp;#39;&lt;/span>)
&lt;span class="cf">if&lt;/span> (x &lt;span class="op">==&lt;/span>&lt;span class="st"> &amp;#39;父親&amp;#39;&lt;/span>) &lt;span class="kw">return&lt;/span>(&lt;span class="st">&amp;#39;Father&amp;#39;&lt;/span>)
&lt;span class="cf">if&lt;/span> (x &lt;span class="op">==&lt;/span>&lt;span class="st"> &amp;#39;無&amp;#39;&lt;/span>) &lt;span class="kw">return&lt;/span>(&lt;span class="st">&amp;#39;None&amp;#39;&lt;/span>)
&lt;span class="cf">if&lt;/span> (x &lt;span class="op">==&lt;/span>&lt;span class="st"> &amp;#39;(外)祖父&amp;#39;&lt;/span>) &lt;span class="kw">return&lt;/span>(&lt;span class="st">&amp;#39;Grandpa&amp;#39;&lt;/span>)
&lt;span class="cf">if&lt;/span> (x &lt;span class="op">==&lt;/span>&lt;span class="st"> &amp;#39;(外)祖母&amp;#39;&lt;/span>) &lt;span class="kw">return&lt;/span>(&lt;span class="st">&amp;#39;Grandma&amp;#39;&lt;/span>)
&lt;span class="cf">if&lt;/span> (x &lt;span class="op">%in%&lt;/span>&lt;span class="st"> &lt;/span>&lt;span class="kw">c&lt;/span>(&lt;span class="st">&amp;#39;阿姨&amp;#39;&lt;/span>, &lt;span class="st">&amp;#39;嬸嬸&amp;#39;&lt;/span>, &lt;span class="st">&amp;#39;舅媽&amp;#39;&lt;/span>, &lt;span class="st">&amp;#39;姑姑&amp;#39;&lt;/span>, &lt;span class="st">&amp;#39;伯母&amp;#39;&lt;/span>)) &lt;span class="kw">return&lt;/span>(&lt;span class="st">&amp;#39;Aunt&amp;#39;&lt;/span>)
&lt;span class="cf">if&lt;/span> (x &lt;span class="op">%in%&lt;/span>&lt;span class="st"> &lt;/span>&lt;span class="kw">c&lt;/span>(&lt;span class="st">&amp;#39;叔叔&amp;#39;&lt;/span>, &lt;span class="st">&amp;#39;伯伯&amp;#39;&lt;/span>, &lt;span class="st">&amp;#39;舅舅&amp;#39;&lt;/span>, &lt;span class="st">&amp;#39;姑丈&amp;#39;&lt;/span>, &lt;span class="st">&amp;#39;姨丈&amp;#39;&lt;/span>)) &lt;span class="kw">return&lt;/span>(&lt;span class="st">&amp;#39;Uncle&amp;#39;&lt;/span>)
&lt;span class="kw">message&lt;/span>(&lt;span class="st">&amp;#39;No translation found for `&amp;#39;&lt;/span>, x, &lt;span class="st">&amp;#39;`&amp;#39;&lt;/span>, &lt;span class="st">&amp;#39;&lt;/span>&lt;span class="ch">\n&lt;/span>&lt;span class="st">&amp;#39;&lt;/span>)
&lt;span class="kw">return&lt;/span>(x)
}
ch2eng_vec &amp;lt;-&lt;span class="st"> &lt;/span>&lt;span class="cf">function&lt;/span>(vec) {
new_vec &amp;lt;-&lt;span class="st"> &lt;/span>&lt;span class="kw">vector&lt;/span>(&lt;span class="kw">typeof&lt;/span>(vec), &lt;span class="kw">length&lt;/span>(vec))
&lt;span class="cf">for&lt;/span> (i &lt;span class="cf">in&lt;/span> &lt;span class="kw">seq_along&lt;/span>(vec)) {
new_vec[[i]] &amp;lt;-&lt;span class="st"> &lt;/span>&lt;span class="kw">ch2eng&lt;/span>(vec[[i]])
}
&lt;span class="kw">return&lt;/span>(new_vec)
}
data &amp;lt;-&lt;span class="st"> &lt;/span>data &lt;span class="op">%&amp;gt;%&lt;/span>&lt;span class="st"> &lt;/span>
&lt;span class="st"> &lt;/span>&lt;span class="kw">mutate&lt;/span>(&lt;span class="dt">gender =&lt;/span> &lt;span class="kw">ch2eng_vec&lt;/span>(gender),
&lt;span class="dt">m_guard_identity =&lt;/span> &lt;span class="kw">ch2eng_vec&lt;/span>(m_guard_identity),
&lt;span class="dt">f_guard_identity =&lt;/span> &lt;span class="kw">ch2eng_vec&lt;/span>(f_guard_identity))
&lt;span class="kw">head&lt;/span>(data)&lt;/code>&lt;/pre>
&lt;div class="kable-table">
&lt;table>
&lt;thead>
&lt;tr class="header">
&lt;th align="left">gender&lt;/th>
&lt;th align="right">age&lt;/th>
&lt;th align="left">m_guard_identity&lt;/th>
&lt;th align="left">f_guard_identity&lt;/th>
&lt;th align="right">Mand_speak&lt;/th>
&lt;th align="right">Tw_speak&lt;/th>
&lt;th align="right">Hak_speak&lt;/th>
&lt;th align="right">Ind_speak&lt;/th>
&lt;th align="right">SEA_speak&lt;/th>
&lt;th align="right">Eng_speak&lt;/th>
&lt;th align="right">dad_Mand_speak&lt;/th>
&lt;th align="right">dad_Tw_speak&lt;/th>
&lt;th align="right">dad_Hak_speak&lt;/th>
&lt;th align="right">dad_Ind_speak&lt;/th>
&lt;th align="right">dad_SEA_speak&lt;/th>
&lt;th align="right">dad_Eng_speak&lt;/th>
&lt;th align="right">mom_Mand_speak&lt;/th>
&lt;th align="right">mom_Tw_speak&lt;/th>
&lt;th align="right">mom_Hak_speak&lt;/th>
&lt;th align="right">mom_Ind_speak&lt;/th>
&lt;th align="right">mom_SEA_speak&lt;/th>
&lt;th align="right">mom_Eng_speak&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr class="odd">
&lt;td align="left">Female&lt;/td>
&lt;td align="right">56&lt;/td>
&lt;td align="left">Father&lt;/td>
&lt;td align="left">Mother&lt;/td>
&lt;td align="right">4&lt;/td>
&lt;td align="right">2&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">1&lt;/td>
&lt;td align="right">3&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">3&lt;/td>
&lt;td align="right">4&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;/tr>
&lt;tr class="even">
&lt;td align="left">Female&lt;/td>
&lt;td align="right">57&lt;/td>
&lt;td align="left">Father&lt;/td>
&lt;td align="left">Mother&lt;/td>
&lt;td align="right">5&lt;/td>
&lt;td align="right">5&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">4&lt;/td>
&lt;td align="right">5&lt;/td>
&lt;td align="right">5&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">1&lt;/td>
&lt;td align="right">1&lt;/td>
&lt;td align="right">5&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;/tr>
&lt;tr class="odd">
&lt;td align="left">Male&lt;/td>
&lt;td align="right">37&lt;/td>
&lt;td align="left">Father&lt;/td>
&lt;td align="left">Mother&lt;/td>
&lt;td align="right">5&lt;/td>
&lt;td align="right">1&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">2&lt;/td>
&lt;td align="right">5&lt;/td>
&lt;td align="right">5&lt;/td>
&lt;td align="right">5&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">1&lt;/td>
&lt;td align="right">5&lt;/td>
&lt;td align="right">3&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">4&lt;/td>
&lt;/tr>
&lt;tr class="even">
&lt;td align="left">Female&lt;/td>
&lt;td align="right">44&lt;/td>
&lt;td align="left">Father&lt;/td>
&lt;td align="left">Mother&lt;/td>
&lt;td align="right">5&lt;/td>
&lt;td align="right">4&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">4&lt;/td>
&lt;td align="right">5&lt;/td>
&lt;td align="right">5&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">5&lt;/td>
&lt;td align="right">5&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;/tr>
&lt;tr class="odd">
&lt;td align="left">Male&lt;/td>
&lt;td align="right">62&lt;/td>
&lt;td align="left">None&lt;/td>
&lt;td align="left">None&lt;/td>
&lt;td align="right">5&lt;/td>
&lt;td align="right">5&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">1&lt;/td>
&lt;td align="right">5&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">4&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">5&lt;/td>
&lt;td align="right">5&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;/tr>
&lt;tr class="even">
&lt;td align="left">Female&lt;/td>
&lt;td align="right">56&lt;/td>
&lt;td align="left">Father&lt;/td>
&lt;td align="left">Mother&lt;/td>
&lt;td align="right">5&lt;/td>
&lt;td align="right">5&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">1&lt;/td>
&lt;td align="right">5&lt;/td>
&lt;td align="right">5&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">5&lt;/td>
&lt;td align="right">5&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;td align="right">0&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;/div>
&lt;div id="defining-ethnicity" class="section level4">
&lt;h4>Defining Ethnicity&lt;/h4>
&lt;p>You might notice that there is no variable in the data which explicitly indicates the ethnicity of the subject. To serve the purpose of this survey – visualizing the vitality of languages in a community, ethnicity is defined solely by the linguistics competence of a subject’s guardians.
To give a specific example, let &lt;code>subject A&lt;/code> has a mother who &lt;strong>can speak&lt;/strong>&lt;a href="#fn2" class="footnote-ref" id="fnref2">&lt;sup>2&lt;/sup>&lt;/a> Mandarin and Taiwanese and a father who speaks Mandarin and Hakka, then &lt;code>subject A&lt;/code> is categorized as a Mandarin, a Taiwanese, and a Hakka simultaneously.&lt;/p>
&lt;p>The function &lt;code>filter_ethnic()&lt;/code> is used to filter out subjects with specified ‘ethnicity’. This function is useful for drawing age-sex pyramid for each of the six languages.&lt;/p>
&lt;pre class="language-r">&lt;code class="language-r">filter_ethnic &amp;lt;-&lt;span class="st"> &lt;/span>&lt;span class="cf">function&lt;/span>(df, lang, &lt;span class="dt">lev =&lt;/span> &lt;span class="dv">3&lt;/span>) {
sp_lang &amp;lt;-&lt;span class="st"> &lt;/span>&lt;span class="kw">vector&lt;/span>(&lt;span class="st">&amp;quot;character&amp;quot;&lt;/span>, &lt;span class="dv">3&lt;/span>)
sp_lang[&lt;span class="dv">1&lt;/span>] &amp;lt;-&lt;span class="st"> &lt;/span>&lt;span class="kw">paste0&lt;/span>(&lt;span class="st">&amp;quot;dad_&amp;quot;&lt;/span>, lang, &lt;span class="st">&amp;quot;_speak&amp;quot;&lt;/span>)
sp_lang[&lt;span class="dv">2&lt;/span>] &amp;lt;-&lt;span class="st"> &lt;/span>&lt;span class="kw">paste0&lt;/span>(&lt;span class="st">&amp;quot;mom_&amp;quot;&lt;/span>, lang, &lt;span class="st">&amp;quot;_speak&amp;quot;&lt;/span>)
sp_lang[&lt;span class="dv">3&lt;/span>] &amp;lt;-&lt;span class="st"> &lt;/span>&lt;span class="kw">paste0&lt;/span>(lang, &lt;span class="st">&amp;quot;_speak&amp;quot;&lt;/span>)
df2 &amp;lt;-&lt;span class="st"> &lt;/span>df &lt;span class="op">%&amp;gt;%&lt;/span>&lt;span class="st"> &lt;/span>
&lt;span class="st"> &lt;/span>&lt;span class="kw">filter&lt;/span>(m_guard_identity &lt;span class="op">!=&lt;/span>&lt;span class="st"> &amp;#39;None&amp;#39;&lt;/span> &lt;span class="op">|&lt;/span>&lt;span class="st"> &lt;/span>f_guard_identity &lt;span class="op">!=&lt;/span>&lt;span class="st"> &amp;#39;None&amp;#39;&lt;/span>) &lt;span class="op">%&amp;gt;%&lt;/span>
&lt;span class="st"> &lt;/span>&lt;span class="kw">filter&lt;/span>(.data[[sp_lang[&lt;span class="dv">1&lt;/span>]]] &lt;span class="op">&amp;gt;=&lt;/span>&lt;span class="st"> &lt;/span>lev &lt;span class="op">|&lt;/span>&lt;span class="st"> &lt;/span>.data[[sp_lang[&lt;span class="dv">2&lt;/span>]]] &lt;span class="op">&amp;gt;=&lt;/span>&lt;span class="st"> &lt;/span>lev) &lt;span class="op">%&amp;gt;%&lt;/span>
&lt;span class="st"> &lt;/span>&lt;span class="kw">select&lt;/span>(age, gender, sp_lang)
&lt;span class="kw">return&lt;/span>(df2)
}&lt;/code>&lt;/pre>
&lt;/div>
&lt;/div>
&lt;div id="assinging-age-group-to-subjects" class="section level3">
&lt;h3>Assinging Age Group to Subjects&lt;/h3>
&lt;p>Remember that the data structure needed for plotting age-sex pyramids requires &lt;strong>age group to be the basic unit&lt;/strong>. &lt;code>data&lt;/code> now consisits of single subjects, and we need information to group subjects together according to their ages. &lt;code>mutate_age_group()&lt;/code> creates a new variable &lt;code>age_group&lt;/code> by the subject’s age.&lt;/p>
&lt;pre class="language-r">&lt;code class="language-r">mutate_age_group &amp;lt;-&lt;span class="st"> &lt;/span>&lt;span class="cf">function&lt;/span>(df, &lt;span class="dt">range =&lt;/span> &lt;span class="dv">5&lt;/span>){
df&lt;span class="op">$&lt;/span>age_group &amp;lt;-&lt;span class="st"> &lt;/span>&lt;span class="kw">as.character&lt;/span>(
&lt;span class="kw">cut&lt;/span>(df&lt;span class="op">$&lt;/span>age, &lt;span class="dt">right =&lt;/span> F, &lt;span class="dt">breaks =&lt;/span> &lt;span class="kw">seq&lt;/span>(&lt;span class="dv">10&lt;/span>, &lt;span class="dv">95&lt;/span>, &lt;span class="dt">by =&lt;/span> range))
)
&lt;span class="kw">return&lt;/span>(df)
}&lt;/code>&lt;/pre>
&lt;p>&lt;code>cut()&lt;/code> takes a numeric vector as its first input, and codes the values of the vector into new values according to the interval they fall into. In &lt;code>mutate_age_group()&lt;/code>, &lt;code>cut()&lt;/code> codes the input vectors according to the intervals specified in the argument &lt;code>breaks&lt;/code>.&lt;/p>
&lt;p>Now we can use these functions to add more information to the data frame. The idea is to first create a separated data frame for each ethnicity&lt;a href="#fn3" class="footnote-ref" id="fnref3">&lt;sup>3&lt;/sup>&lt;/a> (by &lt;code>filter_ethnic()&lt;/code>), then attact new variables to the data frame that indicate a subject’s ethnicity (&lt;code>ethn_group&lt;/code>) and age group (&lt;code>age_group&lt;/code>).&lt;/p>
&lt;pre class="language-r">&lt;code class="language-r">lang &amp;lt;-&lt;span class="st"> &lt;/span>&lt;span class="kw">c&lt;/span>(&lt;span class="st">&amp;#39;Mand&amp;#39;&lt;/span>, &lt;span class="st">&amp;#39;Tw&amp;#39;&lt;/span>, &lt;span class="st">&amp;#39;Hak&amp;#39;&lt;/span>, &lt;span class="st">&amp;#39;Ind&amp;#39;&lt;/span>, &lt;span class="st">&amp;#39;SEA&amp;#39;&lt;/span>, &lt;span class="st">&amp;#39;Eng&amp;#39;&lt;/span>)
lev &amp;lt;-&lt;span class="st"> &lt;/span>&lt;span class="kw">c&lt;/span>(&lt;span class="dv">3&lt;/span>, &lt;span class="dv">3&lt;/span>, &lt;span class="dv">3&lt;/span>, &lt;span class="dv">3&lt;/span>, &lt;span class="dv">3&lt;/span>, &lt;span class="dv">0&lt;/span>)
ethn_list_df &amp;lt;-&lt;span class="st"> &lt;/span>&lt;span class="kw">vector&lt;/span>(&lt;span class="st">&amp;quot;list&amp;quot;&lt;/span>, &lt;span class="kw">length&lt;/span>(lang))
&lt;span class="cf">for&lt;/span> (i &lt;span class="cf">in&lt;/span> &lt;span class="kw">seq_along&lt;/span>(lang)){
ethn_list_df[[i]] &amp;lt;-&lt;span class="st"> &lt;/span>&lt;span class="kw">filter_ethnic&lt;/span>(data,
&lt;span class="dt">lang =&lt;/span> lang[i],
&lt;span class="dt">lev =&lt;/span> lev[i]) &lt;span class="op">%&amp;gt;%&lt;/span>
&lt;span class="st"> &lt;/span>&lt;span class="kw">mutate&lt;/span>(&lt;span class="dt">ethn_group =&lt;/span> lang[i]) &lt;span class="op">%&amp;gt;%&lt;/span>
&lt;span class="st"> &lt;/span>&lt;span class="kw">mutate_age_group&lt;/span>() &lt;span class="op">%&amp;gt;%&lt;/span>
&lt;span class="st"> &lt;/span>&lt;span class="kw">select&lt;/span>(age, gender, age_group, ethn_group,
&lt;span class="kw">paste0&lt;/span>(lang[i], &lt;span class="st">&amp;quot;_speak&amp;quot;&lt;/span>)) &lt;span class="op">%&amp;gt;%&lt;/span>
&lt;span class="st"> &lt;/span>&lt;span class="kw">rename&lt;/span>(&lt;span class="dt">lang_fluency =&lt;/span> &lt;span class="kw">paste0&lt;/span>(lang[i], &lt;span class="st">&amp;quot;_speak&amp;quot;&lt;/span>))
}&lt;/code>&lt;/pre>
&lt;p>Then we can recombine these data frames back to a single one, and this new data frame now has information about a subject’s ethinicity and age group he/she belongs to. (Note that the new data frame is &lt;strong>expended&lt;/strong> since one subject can have several ethnicity, i.e. one subject can appear in different rows of the data frame with different ethnicity.)&lt;/p>
&lt;pre class="language-r">&lt;code class="language-r">&lt;span class="kw">bind_rows&lt;/span>(ethn_list_df) &lt;span class="op">%&amp;gt;%&lt;/span>&lt;span class="st"> &lt;/span>&lt;span class="kw">head&lt;/span>()&lt;/code>&lt;/pre>
&lt;div class="kable-table">
&lt;table>
&lt;thead>
&lt;tr class="header">
&lt;th align="right">age&lt;/th>
&lt;th align="left">gender&lt;/th>
&lt;th align="left">age_group&lt;/th>
&lt;th align="left">ethn_group&lt;/th>
&lt;th align="right">lang_fluency&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr class="odd">
&lt;td align="right">56&lt;/td>
&lt;td align="left">Female&lt;/td>
&lt;td align="left">[55,60)&lt;/td>
&lt;td align="left">Mand&lt;/td>
&lt;td align="right">4&lt;/td>
&lt;/tr>
&lt;tr class="even">
&lt;td align="right">57&lt;/td>
&lt;td align="left">Female&lt;/td>
&lt;td align="left">[55,60)&lt;/td>
&lt;td align="left">Mand&lt;/td>
&lt;td align="right">5&lt;/td>
&lt;/tr>
&lt;tr class="odd">
&lt;td align="right">37&lt;/td>
&lt;td align="left">Male&lt;/td>
&lt;td align="left">[35,40)&lt;/td>
&lt;td align="left">Mand&lt;/td>
&lt;td align="right">5&lt;/td>
&lt;/tr>
&lt;tr class="even">
&lt;td align="right">44&lt;/td>
&lt;td align="left">Female&lt;/td>
&lt;td align="left">[40,45)&lt;/td>
&lt;td align="left">Mand&lt;/td>
&lt;td align="right">5&lt;/td>
&lt;/tr>
&lt;tr class="odd">
&lt;td align="right">56&lt;/td>
&lt;td align="left">Female&lt;/td>
&lt;td align="left">[55,60)&lt;/td>
&lt;td align="left">Mand&lt;/td>
&lt;td align="right">5&lt;/td>
&lt;/tr>
&lt;tr class="even">
&lt;td align="right">53&lt;/td>
&lt;td align="left">Male&lt;/td>
&lt;td align="left">[50,55)&lt;/td>
&lt;td align="left">Mand&lt;/td>
&lt;td align="right">5&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;/div>
&lt;/div>
&lt;div id="data-for-plotting" class="section level3">
&lt;h3>Data for Plotting&lt;/h3>
&lt;p>Finally, we are ready to group the subjects together according to his/her &lt;code>gender&lt;/code>, &lt;code>ethnicity&lt;/code>, and &lt;code>age_group&lt;/code>. After grouping, we can use &lt;code>dplyr::summarise()&lt;/code> to calculate each group’s fluency of the language, which will be used as the variable on the horizontal axis of the age-sex pyramid.&lt;/p>
&lt;pre class="language-r">&lt;code class="language-r">pl_data &amp;lt;-&lt;span class="st"> &lt;/span>&lt;span class="kw">bind_rows&lt;/span>(ethn_list_df) &lt;span class="op">%&amp;gt;%&lt;/span>
&lt;span class="st"> &lt;/span>&lt;span class="kw">group_by&lt;/span>(gender, ethn_group, age_group) &lt;span class="op">%&amp;gt;%&lt;/span>
&lt;span class="st"> &lt;/span>&lt;span class="kw">summarise&lt;/span>(&lt;span class="kw">mean&lt;/span>(lang_fluency)) &lt;span class="op">%&amp;gt;%&lt;/span>
&lt;span class="st"> &lt;/span>&lt;span class="kw">rename&lt;/span>(&lt;span class="dt">avg_fluency =&lt;/span> &lt;span class="st">`&lt;/span>&lt;span class="dt">mean(lang_fluency)&lt;/span>&lt;span class="st">`&lt;/span>)
&lt;span class="kw">head&lt;/span>(pl_data)&lt;/code>&lt;/pre>
&lt;div class="kable-table">
&lt;table>
&lt;thead>
&lt;tr class="header">
&lt;th align="left">gender&lt;/th>
&lt;th align="left">ethn_group&lt;/th>
&lt;th align="left">age_group&lt;/th>
&lt;th align="right">avg_fluency&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr class="odd">
&lt;td align="left">Female&lt;/td>
&lt;td align="left">Eng&lt;/td>
&lt;td align="left">[15,20)&lt;/td>
&lt;td align="right">1.750&lt;/td>
&lt;/tr>
&lt;tr class="even">
&lt;td align="left">Female&lt;/td>
&lt;td align="left">Eng&lt;/td>
&lt;td align="left">[20,25)&lt;/td>
&lt;td align="right">2.950&lt;/td>
&lt;/tr>
&lt;tr class="odd">
&lt;td align="left">Female&lt;/td>
&lt;td align="left">Eng&lt;/td>
&lt;td align="left">[25,30)&lt;/td>
&lt;td align="right">2.600&lt;/td>
&lt;/tr>
&lt;tr class="even">
&lt;td align="left">Female&lt;/td>
&lt;td align="left">Eng&lt;/td>
&lt;td align="left">[30,35)&lt;/td>
&lt;td align="right">3.000&lt;/td>
&lt;/tr>
&lt;tr class="odd">
&lt;td align="left">Female&lt;/td>
&lt;td align="left">Eng&lt;/td>
&lt;td align="left">[35,40)&lt;/td>
&lt;td align="right">1.750&lt;/td>
&lt;/tr>
&lt;tr class="even">
&lt;td align="left">Female&lt;/td>
&lt;td align="left">Eng&lt;/td>
&lt;td align="left">[40,45)&lt;/td>
&lt;td align="right">2.125&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;/div>
&lt;/div>
&lt;div id="plotting-function" class="section level3">
&lt;h3>Plotting Function&lt;/h3>
&lt;p>We are going to draw 6 age-sex pyramids, one for each languages. So instead of writing &lt;code>ggplot()&lt;/code> six times, I wrote a plotting function:&lt;/p>
&lt;pre class="language-r">&lt;code class="language-r">&lt;span class="kw">library&lt;/span>(ggplot2)
pl_pyramid &amp;lt;-&lt;span class="st"> &lt;/span>&lt;span class="cf">function&lt;/span>(data, &lt;span class="dt">title =&lt;/span> &lt;span class="ot">NULL&lt;/span>) {
&lt;span class="kw">ggplot&lt;/span>(data,
&lt;span class="kw">aes&lt;/span>(&lt;span class="dt">x =&lt;/span> age_group,
&lt;span class="dt">y =&lt;/span> &lt;span class="kw">ifelse&lt;/span>(gender &lt;span class="op">==&lt;/span>&lt;span class="st"> &amp;#39;Male&amp;#39;&lt;/span>, avg_fluency, &lt;span class="op">-&lt;/span>avg_fluency),
&lt;span class="dt">fill =&lt;/span> gender)) &lt;span class="op">+&lt;/span>
&lt;span class="st"> &lt;/span>&lt;span class="kw">geom_bar&lt;/span>(&lt;span class="dt">stat =&lt;/span> &lt;span class="st">&amp;quot;identity&amp;quot;&lt;/span>, &lt;span class="dt">width =&lt;/span> &lt;span class="fl">0.7&lt;/span>) &lt;span class="op">+&lt;/span>
&lt;span class="st"> &lt;/span>&lt;span class="kw">scale_y_continuous&lt;/span>(&lt;span class="dt">limits =&lt;/span> &lt;span class="kw">c&lt;/span>(&lt;span class="op">-&lt;/span>&lt;span class="dv">5&lt;/span>, &lt;span class="dv">5&lt;/span>),
&lt;span class="dt">breaks =&lt;/span> &lt;span class="kw">seq&lt;/span>(&lt;span class="op">-&lt;/span>&lt;span class="dv">5&lt;/span>, &lt;span class="dv">5&lt;/span>, &lt;span class="dv">1&lt;/span>),
&lt;span class="dt">labels =&lt;/span> &lt;span class="kw">abs&lt;/span>(&lt;span class="kw">seq&lt;/span>(&lt;span class="op">-&lt;/span>&lt;span class="dv">5&lt;/span>, &lt;span class="dv">5&lt;/span>, &lt;span class="dv">1&lt;/span>))) &lt;span class="op">+&lt;/span>
&lt;span class="st"> &lt;/span>&lt;span class="kw">coord_flip&lt;/span>() &lt;span class="op">+&lt;/span>
&lt;span class="st"> &lt;/span>&lt;span class="kw">scale_fill_manual&lt;/span>(&lt;span class="dt">values =&lt;/span> &lt;span class="kw">c&lt;/span>(&lt;span class="st">&amp;quot;#E41A1C&amp;quot;&lt;/span>, &lt;span class="st">&amp;quot;#377EB8&amp;quot;&lt;/span>),
&lt;span class="dt">breaks =&lt;/span> &lt;span class="kw">c&lt;/span>(&lt;span class="st">&amp;quot;Female&amp;quot;&lt;/span>, &lt;span class="st">&amp;quot;Male&amp;quot;&lt;/span>)) &lt;span class="op">+&lt;/span>
&lt;span class="st"> &lt;/span>&lt;span class="kw">labs&lt;/span>(&lt;span class="dt">x =&lt;/span> &lt;span class="st">&amp;quot;Age&amp;quot;&lt;/span>, &lt;span class="dt">y =&lt;/span> &lt;span class="st">&amp;quot;Fluency&amp;quot;&lt;/span>, &lt;span class="dt">fill =&lt;/span> &lt;span class="st">&amp;quot;&amp;quot;&lt;/span>, &lt;span class="dt">title =&lt;/span> title)
}&lt;/code>&lt;/pre>
&lt;p>Now we can start plotting. Let’s try &lt;code>Mand&lt;/code> (Mandarin) and &lt;code>Hak&lt;/code> (Hakka) first. We can use &lt;code>dplyr::filter()&lt;/code> to filter out people speaking these languages:&lt;/p>
&lt;pre class="language-r">&lt;code class="language-r">tweak &amp;lt;-&lt;span class="st"> &lt;/span>&lt;span class="kw">theme_bw&lt;/span>() &lt;span class="op">+&lt;/span>&lt;span class="st"> &lt;/span>
&lt;span class="st"> &lt;/span>&lt;span class="kw">theme&lt;/span>(&lt;span class="dt">axis.text =&lt;/span> &lt;span class="kw">element_text&lt;/span>(&lt;span class="dt">size =&lt;/span> &lt;span class="dv">15&lt;/span>),
&lt;span class="dt">legend.justification =&lt;/span> &lt;span class="st">&amp;quot;right&amp;quot;&lt;/span>,
&lt;span class="dt">legend.position =&lt;/span> &lt;span class="st">&amp;quot;bottom&amp;quot;&lt;/span>,
&lt;span class="dt">legend.box =&lt;/span> &lt;span class="st">&amp;quot;vertical&amp;quot;&lt;/span>)
pl_data &lt;span class="op">%&amp;gt;%&lt;/span>
&lt;span class="st"> &lt;/span>&lt;span class="kw">filter&lt;/span>(ethn_group &lt;span class="op">==&lt;/span>&lt;span class="st"> &amp;#39;Mand&amp;#39;&lt;/span>) &lt;span class="op">%&amp;gt;%&lt;/span>&lt;span class="st"> &lt;/span>
&lt;span class="st"> &lt;/span>&lt;span class="kw">pl_pyramid&lt;/span>(&lt;span class="dt">title =&lt;/span> &lt;span class="st">&amp;#39;Mandarin&amp;#39;&lt;/span>) &lt;span class="op">+&lt;/span>&lt;span class="st"> &lt;/span>tweak
pl_data &lt;span class="op">%&amp;gt;%&lt;/span>
&lt;span class="st"> &lt;/span>&lt;span class="kw">filter&lt;/span>(ethn_group &lt;span class="op">==&lt;/span>&lt;span class="st"> &amp;#39;Ind&amp;#39;&lt;/span>) &lt;span class="op">%&amp;gt;%&lt;/span>&lt;span class="st"> &lt;/span>
&lt;span class="st"> &lt;/span>&lt;span class="kw">pl_pyramid&lt;/span>(&lt;span class="dt">title =&lt;/span> &lt;span class="st">&amp;#39;Formosan Languages&amp;#39;&lt;/span>) &lt;span class="op">+&lt;/span>&lt;span class="st"> &lt;/span>tweak&lt;/code>&lt;/pre>
&lt;p>&lt;img src="https://img.yongfu.name/assets/visualize-language-loss/unnamed-chunk-12-1.svg" width="49%" />&lt;img src="https://img.yongfu.name/assets/visualize-language-loss/unnamed-chunk-12-2.svg" width="49%" />&lt;/p>
&lt;p>Wait! It seems quite strange. The age-sex pyramid of ‘Formosan Languages’ doesn’t look like a pyramid at all!
This is because there were very few subjects defined as ‘indigenous people’ in the survey. To make plots like this (with only one or two age groups) comparable to others (such as that in ‘Mandarin’), we need one more function to &lt;strong>insert missing age groups&lt;/strong> to the data frame so that ggplot can draw empty bars for us.&lt;/p>
&lt;p>First, we need to find out &lt;strong>all age groups in the data&lt;/strong>:&lt;/p>
&lt;pre class="language-r">&lt;code class="language-r">age_groups &amp;lt;-&lt;span class="st"> &lt;/span>&lt;span class="kw">unique&lt;/span>(pl_data&lt;span class="op">$&lt;/span>age_group)
age_groups&lt;/code>&lt;/pre>
&lt;pre>&lt;code class="nohighlight"> [1] &amp;quot;[15,20)&amp;quot; &amp;quot;[20,25)&amp;quot; &amp;quot;[25,30)&amp;quot; &amp;quot;[30,35)&amp;quot; &amp;quot;[35,40)&amp;quot; &amp;quot;[40,45)&amp;quot; &amp;quot;[45,50)&amp;quot;
[8] &amp;quot;[50,55)&amp;quot; &amp;quot;[55,60)&amp;quot; &amp;quot;[60,65)&amp;quot; &amp;quot;[65,70)&amp;quot;&lt;/code>&lt;/pre>
&lt;p>Then we can write a function &lt;code>fill_empty_age_group()&lt;/code>, which takes a data frame as its first argument and checks whether there are age groups missing in the data frame (using its second argument, &lt;code>age_group_all&lt;/code>, as comparison). If the age group is missing, &lt;code>fill_empty_age_group()&lt;/code> appends a new row, which has &lt;code>age_group&lt;/code> set to the missing age group and &lt;code>avg_fluency&lt;/code> set to &lt;code>0&lt;/code> (create an empty bar), to the input data frame.&lt;/p>
&lt;pre class="language-r">&lt;code class="language-r">fill_empty_age_group &amp;lt;-&lt;span class="st"> &lt;/span>&lt;span class="cf">function&lt;/span>(df, age_group_all) {
&lt;span class="cf">for&lt;/span> (i &lt;span class="cf">in&lt;/span> &lt;span class="kw">seq_along&lt;/span>(age_group_all)) {
&lt;span class="cf">if&lt;/span> (&lt;span class="op">!&lt;/span>(age_group_all[i] &lt;span class="op">%in%&lt;/span>&lt;span class="st"> &lt;/span>df&lt;span class="op">$&lt;/span>age_group)) {
df &amp;lt;-&lt;span class="st"> &lt;/span>&lt;span class="kw">rbind&lt;/span>(df, &lt;span class="kw">list&lt;/span>(&lt;span class="dt">gender =&lt;/span> &lt;span class="st">&amp;quot;Female&amp;quot;&lt;/span>,
&lt;span class="dt">ethn_group =&lt;/span> &lt;span class="st">&amp;quot;doesnt_matter&amp;quot;&lt;/span>,
&lt;span class="dt">age_group =&lt;/span> age_group_all[i],
&lt;span class="dt">avg_fluency =&lt;/span> &lt;span class="dv">0&lt;/span>))
}
}
&lt;span class="kw">return&lt;/span>(df)
}&lt;/code>&lt;/pre>
&lt;p>Now we’re ready to explore language loss in Taiwan. &lt;code>multiplot()&lt;/code> is used to put multiple plots together. The source code of &lt;code>multiplot()&lt;/code> is copied directly from Winston Chang’s &lt;a href="http://www.cookbook-r.com/Graphs/Multiple_graphs_on_one_page_(ggplot2)">Cookbook for R&lt;/a>.&lt;/p>
&lt;pre class="language-r">&lt;code class="language-r">tweak2 &amp;lt;-&lt;span class="st"> &lt;/span>&lt;span class="kw">theme_bw&lt;/span>() &lt;span class="op">+&lt;/span>&lt;span class="st"> &lt;/span>
&lt;span class="st"> &lt;/span>&lt;span class="kw">theme&lt;/span>(&lt;span class="dt">legend.justification =&lt;/span> &lt;span class="st">&amp;quot;right&amp;quot;&lt;/span>,
&lt;span class="dt">legend.position =&lt;/span> &lt;span class="st">&amp;quot;bottom&amp;quot;&lt;/span>,
&lt;span class="dt">legend.box =&lt;/span> &lt;span class="st">&amp;quot;vertical&amp;quot;&lt;/span>)
py1 &amp;lt;-&lt;span class="st"> &lt;/span>pl_data &lt;span class="op">%&amp;gt;%&lt;/span>
&lt;span class="st"> &lt;/span>&lt;span class="kw">filter&lt;/span>(ethn_group &lt;span class="op">==&lt;/span>&lt;span class="st"> &amp;#39;Mand&amp;#39;&lt;/span>) &lt;span class="op">%&amp;gt;%&lt;/span>&lt;span class="st"> &lt;/span>
&lt;span class="st"> &lt;/span>&lt;span class="kw">fill_empty_age_group&lt;/span>(age_groups) &lt;span class="op">%&amp;gt;%&lt;/span>
&lt;span class="st"> &lt;/span>&lt;span class="kw">pl_pyramid&lt;/span>(&lt;span class="dt">title =&lt;/span> &lt;span class="st">&amp;#39;Mandarin&amp;#39;&lt;/span>) &lt;span class="op">+&lt;/span>&lt;span class="st"> &lt;/span>tweak2
py2 &amp;lt;-&lt;span class="st"> &lt;/span>pl_data &lt;span class="op">%&amp;gt;%&lt;/span>
&lt;span class="st"> &lt;/span>&lt;span class="kw">filter&lt;/span>(ethn_group &lt;span class="op">==&lt;/span>&lt;span class="st"> &amp;#39;Tw&amp;#39;&lt;/span>) &lt;span class="op">%&amp;gt;%&lt;/span>
&lt;span class="st"> &lt;/span>&lt;span class="kw">fill_empty_age_group&lt;/span>(age_groups) &lt;span class="op">%&amp;gt;%&lt;/span>
&lt;span class="st"> &lt;/span>&lt;span class="kw">pl_pyramid&lt;/span>(&lt;span class="dt">title =&lt;/span> &lt;span class="st">&amp;#39;Taiwanese&amp;#39;&lt;/span>) &lt;span class="op">+&lt;/span>&lt;span class="st"> &lt;/span>tweak2
py3 &amp;lt;-&lt;span class="st"> &lt;/span>pl_data &lt;span class="op">%&amp;gt;%&lt;/span>
&lt;span class="st"> &lt;/span>&lt;span class="kw">filter&lt;/span>(ethn_group &lt;span class="op">==&lt;/span>&lt;span class="st"> &amp;#39;Hak&amp;#39;&lt;/span>) &lt;span class="op">%&amp;gt;%&lt;/span>
&lt;span class="st"> &lt;/span>&lt;span class="kw">fill_empty_age_group&lt;/span>(age_groups) &lt;span class="op">%&amp;gt;%&lt;/span>
&lt;span class="st"> &lt;/span>&lt;span class="kw">pl_pyramid&lt;/span>(&lt;span class="dt">title =&lt;/span> &lt;span class="st">&amp;#39;Hakka&amp;#39;&lt;/span>) &lt;span class="op">+&lt;/span>&lt;span class="st"> &lt;/span>tweak2
py4 &amp;lt;-&lt;span class="st"> &lt;/span>pl_data &lt;span class="op">%&amp;gt;%&lt;/span>
&lt;span class="st"> &lt;/span>&lt;span class="kw">filter&lt;/span>(ethn_group &lt;span class="op">==&lt;/span>&lt;span class="st"> &amp;#39;Ind&amp;#39;&lt;/span>) &lt;span class="op">%&amp;gt;%&lt;/span>
&lt;span class="st"> &lt;/span>&lt;span class="kw">fill_empty_age_group&lt;/span>(age_groups) &lt;span class="op">%&amp;gt;%&lt;/span>
&lt;span class="st"> &lt;/span>&lt;span class="kw">pl_pyramid&lt;/span>(&lt;span class="dt">title =&lt;/span> &lt;span class="st">&amp;#39;Formosan Languages&amp;#39;&lt;/span>) &lt;span class="op">+&lt;/span>&lt;span class="st"> &lt;/span>tweak2
py5 &amp;lt;-&lt;span class="st"> &lt;/span>pl_data &lt;span class="op">%&amp;gt;%&lt;/span>
&lt;span class="st"> &lt;/span>&lt;span class="kw">filter&lt;/span>(ethn_group &lt;span class="op">==&lt;/span>&lt;span class="st"> &amp;#39;SEA&amp;#39;&lt;/span>) &lt;span class="op">%&amp;gt;%&lt;/span>
&lt;span class="st"> &lt;/span>&lt;span class="kw">fill_empty_age_group&lt;/span>(age_groups) &lt;span class="op">%&amp;gt;%&lt;/span>
&lt;span class="st"> &lt;/span>&lt;span class="kw">pl_pyramid&lt;/span>(&lt;span class="dt">title =&lt;/span> &lt;span class="st">&amp;#39;Languages of South East Asia&amp;#39;&lt;/span>) &lt;span class="op">+&lt;/span>&lt;span class="st"> &lt;/span>tweak2
py6 &amp;lt;-&lt;span class="st"> &lt;/span>pl_data &lt;span class="op">%&amp;gt;%&lt;/span>
&lt;span class="st"> &lt;/span>&lt;span class="kw">filter&lt;/span>(ethn_group &lt;span class="op">==&lt;/span>&lt;span class="st"> &amp;#39;Eng&amp;#39;&lt;/span>) &lt;span class="op">%&amp;gt;%&lt;/span>
&lt;span class="st"> &lt;/span>&lt;span class="kw">fill_empty_age_group&lt;/span>(age_groups) &lt;span class="op">%&amp;gt;%&lt;/span>
&lt;span class="st"> &lt;/span>&lt;span class="kw">pl_pyramid&lt;/span>(&lt;span class="dt">title =&lt;/span> &lt;span class="st">&amp;#39;English&amp;#39;&lt;/span>) &lt;span class="op">+&lt;/span>&lt;span class="st"> &lt;/span>tweak2
&lt;span class="kw">multiplot&lt;/span>(py1, py2, py3, py4, py5, py6, &lt;span class="dt">cols =&lt;/span> &lt;span class="dv">2&lt;/span>)&lt;/code>&lt;/pre>
&lt;p>&lt;img src="https://img.yongfu.name/assets/visualize-language-loss/unnamed-chunk-16-1.svg" width="100%" />&lt;/p>
&lt;/div>
&lt;/div>
&lt;div id="language-loss-in-taiwan" class="section level2">
&lt;h2>Language Loss in Taiwan&lt;/h2>
&lt;p>As described in &lt;a href="#age-sex-pyramid-of-language">Age-Sex Pyramid of Language&lt;/a> above, we can learn about a language’s vitality in Taiwan from the age-sex pyramids drawn above.&lt;/p>
&lt;p>For Formosan and South East Asian languages, there are too few data, and we can’t learn much about these languages from the plots. For Mandarin, the shape of the pyramid is rectangular, indicating the linguistic competence of Mandarin is stable across people of all ages. This is expected as Mandarin, in Taiwan, is the most prevalent language, and most people use it as the primary language in workplace and home.&lt;/p>
&lt;p>Pyramids of Taiwanese and Hakka have inverted trianglular shapes, indicating lower linguistic competence among yonger people. Indeed, it’s not uncommmon to see the fathers and mothers talk to their children in Mandarin but talk to their parents in Taiwanese. Taiwanese is the second prevalent language in Taiwan, but it is shrinking, particularly among young people. Hakka ranks third in prevalence. It faces similar situation to Taiwanese but the situation is even worse, since the usage of Hakka is mostly restricted to Hakka people whereas usage of Taiwanese is not restricted to particular groups of people (many indigenous and Hakka peoples speak fluent Taiwanese).&lt;/p>
&lt;p>English has a special status in Taiwan. It is not a native tongue to people born and raised in Taiwan, but many people know at least a little English. This is because formal education and the (awareness of) globalization lead parents to place importance on English education of their children. This also gives the age-sex pyramid of English its appearance – a triangular shape with wider bottom than top. English is the only language that is growing in Taiwan and, arguably, the language with the strongest vitality. &lt;a href="#tab:tw-pyramids">Table 1&lt;/a> summarizes the discussion above.&lt;/p>
&lt;table>
&lt;caption>&lt;span id="tab:tw-pyramids">Table 1: &lt;/span> Situations of the four most prevalent languages in Taiwan.&lt;/caption>
&lt;thead>
&lt;tr class="header">
&lt;th>&lt;strong>Vitality of Language&lt;/strong>&lt;/th>
&lt;th>&lt;strong>Shape of Pyramid&lt;/strong>&lt;/th>
&lt;th>&lt;strong>Examples (Taiwan)&lt;/strong>&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr class="odd">
&lt;td>Shrinking and Dying&lt;/td>
&lt;td>Inverted Triangle&lt;/td>
&lt;td>Taiwanese, Hakka&lt;/td>
&lt;/tr>
&lt;tr class="even">
&lt;td>Growing&lt;/td>
&lt;td>Triangle&lt;/td>
&lt;td>English&lt;/td>
&lt;/tr>
&lt;tr class="odd">
&lt;td>Stable&lt;/td>
&lt;td>Rectangular Bar&lt;/td>
&lt;td>Mandarin&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;/div>
&lt;div class="footnotes">
&lt;ol>
&lt;li id="fn1">&lt;p>The samples are not representative though, and it might only reflect the situation in Taipei (see the geographical distribution of the samples below). But I think there are still reasons to believe that other locations in Taiwan have similar phenomena.&lt;/p>
&lt;p>&lt;img src="https://twlangsurvey.github.io/out_graph/sample_spatial_distr.gif" title="fig:" alt="geo-distribution of samples" style="width: 43%;display:block; margin-left:auto;margin-right:auto" />&lt;a href="#fnref1" class="footnote-back">↩&lt;/a>&lt;/p>&lt;/li>
&lt;li id="fn2">&lt;p>Defined by scoring 3 or above in a self-reported 6-point scale measuring the fluency of a language spoken by the subject’s parents.&lt;a href="#fnref2" class="footnote-back">↩&lt;/a>&lt;/p>&lt;/li>
&lt;li id="fn3">&lt;p>For English, different from all other languages, the level used to determine ethnicity is &lt;code>0&lt;/code>, i.e. there is no filtering occuring, and all subjects are used. This is because, in Taiwan (and many other non-English speaking communities as well), English is not related to ethnicity and is strongly related to formal education and job requirements.&lt;a href="#fnref3" class="footnote-back">↩&lt;/a>&lt;/p>&lt;/li>
&lt;/ol>
&lt;/div>
&lt;p style="text-align:right;font-size:7px;margin-top:0px;margin-bottom:0px;padding-top:0px;padding-bottom:1px">
Last updated: 2019-04-03
&lt;/p></description><category>Linguistics</category><category>visualization</category><category>Web Page</category><category>Travis-CI</category><category>R</category><category>R-bloggers</category></item><item><title>Customizing Hugo / Blogdown RSS Templates</title><link>https://yongfu.name/2018/12/13/hugo_rss/</link><pubDate>Thu, 13 Dec 2018 00:00:00 +0000</pubDate><guid>https://yongfu.name/2018/12/13/hugo_rss/</guid><description>&lt;p>&lt;a href="https://github.com/rstudio/blogdown">Blogdown&lt;/a> makes it easy to create Hugo blogs or personal websites, and it is becoming more and more popular in the R community. Once the blog is created, people might want to submit their blogs&amp;rsquo; RSS feeds to &lt;a href="https://www.r-bloggers.com/">R-bloggers&lt;/a>. But before that can happen, one must modify the RSS template to meet the &lt;a href="https://www.r-bloggers.com/add-your-blog/">requirements&lt;/a> of RSS submission.&lt;/p>
&lt;p>Due to my successful experience in &lt;a href="https://yongfu.name/2018/08/02/rblogger-criteria.html">creating a new Jekyll RSS template&lt;/a> for my blog, I thought it would be easy to customize the RSS template of Hugo blogs to make it suitable for &lt;strong>R-bloggers&lt;/strong>. &lt;em>I was WRONG&lt;/em>. Hugo has stricter rules for modifying RSS templates&lt;sup id="fnref:1">&lt;a href="#fn:1" class="footnote-ref" role="doc-noteref">1&lt;/a>&lt;/sup>, and it took me a while to figure out how to modify the &lt;strong>category/tag RSS templates&lt;/strong>.&lt;/p>
&lt;p>By default, Hugo generates different RSS feeds for each section and taxonomy&lt;sup id="fnref:2">&lt;a href="#fn:2" class="footnote-ref" role="doc-noteref">2&lt;/a>&lt;/sup>. I will write about how to modify &lt;em>a subset of them&lt;/em> to create category- or tag-specific RSS feeds for &lt;strong>R-bloggers&lt;/strong>, i.e, making the &lt;code>&amp;lt;description&amp;gt;&lt;/code> field of the RSS feed display &lt;strong>full content&lt;/strong>, rather than an excerpt, of a post.&lt;/p>
&lt;h2 id="overwriting-the-default-rss-template">Overwriting the default RSS Template&lt;/h2>
&lt;p>You won&amp;rsquo;t find any RSS template files shipped with Hugo themes (at least &lt;a href="https://github.com/gcushen/hugo-academic">Hugo Acadimic theme&lt;/a> doesn&amp;rsquo;t). RSS files (&lt;code>index.xml&lt;/code>) will be generated (in &lt;code>public/&lt;/code>) according to the default RSS template.&lt;/p>
&lt;p>To override the default RSS template &lt;strong>without touching the theme template&lt;/strong>,&lt;/p>
&lt;ol>
&lt;li>
&lt;p>Copy the &lt;a href="https://gohugo.io/templates/rss/#the-embedded-rss-xml">default RSS template&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Change &lt;code>&amp;lt;description&amp;gt;{% raw %}{{ .Summary | html }}{% endraw %}&amp;lt;/description&amp;gt;&lt;/code> to &lt;code>&amp;lt;description&amp;gt;{% raw %}{{ .Content | html }}{% endraw %}&amp;lt;/description&amp;gt;&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Create subdirectories in &lt;code>layouts/&lt;/code> and save the RSS template files (name them &lt;code>rss.xml&lt;/code>) in them (one for each subdirectory).&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>Putting RSS templates in different subdirectories will have effects on different kind of RSS feeds. The file name (e.g. &lt;code>rss.xml&lt;/code>) of the template also matters and can&amp;rsquo;t be arbitrary. Read Hugo&amp;rsquo;s documentation on &lt;a href="https://gohugo.io/templates/rss/#lookup-order-for-rss-templates">Lookup Order for RSS Templates&lt;/a> for details&lt;sup id="fnref:3">&lt;a href="#fn:3" class="footnote-ref" role="doc-noteref">3&lt;/a>&lt;/sup>.&lt;/p>
&lt;h2 id="an-example-hugo-acadimic-theme">An Example: Hugo Acadimic Theme&lt;/h2>
&lt;p>I use &lt;a href="https://github.com/gcushen/hugo-academic">Hugo Acadimic theme&lt;/a> as an example to set two kinds of RSS templates:&lt;/p>
&lt;ol>
&lt;li>
&lt;p>A template that causes &lt;strong>RSS feeds under every category&lt;/strong> to display &lt;em>full content&lt;/em> of the posts&lt;/p>
&lt;ul>
&lt;li>Browse &lt;a href="https://liao961120.github.io/Hugo-RSS/categories/r/index.xml">RSS feed&lt;/a>&lt;/li>
&lt;li>GitHub source: &lt;a href="https://github.com/liao961120/Hugo-RSS/blob/master/layouts/categories/rss.xml">layouts/categories/rss.xml&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>A template with &lt;code>&amp;lt;category&amp;gt;&lt;/code> fields to capture all &lt;em>post tags&lt;/em>&lt;/p>
&lt;ul>
&lt;li>Browse &lt;a href="https://liao961120.github.io/Hugo-RSS/post/index.xml">RSS feed&lt;/a>&lt;/li>
&lt;li>GitHub source: &lt;a href="https://github.com/liao961120/Hugo-RSS/blob/master/layouts/post/rss.xml">layouts/post/rss.xml&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;h3 id="directory-tree">Directory Tree&lt;/h3>
&lt;p>Below is the directory structure (simplified) after adding RSS templates to &lt;strong>Hugo Acadimic theme&lt;/strong>. I added and modified &lt;code>rss.xml&lt;/code> in &lt;code>/layouts/post/&lt;/code> and &lt;code>/layouts/categories/&lt;/code>. Then &lt;code>/docs/post/index.xml&lt;/code> and &lt;!-- raw HTML omitted -->/docs/categories/&lt;!-- raw HTML omitted -->r&lt;!-- raw HTML omitted -->/index.xml&lt;!-- raw HTML omitted --> get generated according to &lt;code>/layouts/post/rss.xml&lt;/code> and &lt;code>/layouts/categories/rss.xml&lt;/code>, respectively.&lt;/p>
&lt;p>Note that &lt;code>/docs&lt;/code> is &lt;code>/public&lt;/code> by default, when &lt;code>publishDir = &amp;quot;docs&amp;quot;&lt;/code> is not set in &lt;code>/config.toml&lt;/code>. Using &lt;code>/docs&lt;/code> allows me to &lt;a href="https://gohugo.io/hosting-and-deployment/hosting-on-github/">publish Hugo blog on GitHub Pages&lt;/a>. &lt;strong>DO NOT add &lt;code>publishDir = &amp;quot;docs&amp;quot;&lt;/code> in &lt;code>config.toml&lt;/code> if you&amp;rsquo;re serving the site with netlify&lt;/strong>.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">/&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">├── index.Rmd&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">├── Hugo-RSS.Rproj&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">├── config.toml&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">├── content/&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">│   ├── home/&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">│   └── post/&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">│      ├── 2015-07-23-r-rmarkdown.html&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">│      └── 2015-07-23-r-rmarkdown.Rmd&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">│&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">├── layouts/&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">│   ├── post/&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">│   │   └── rss.xml &lt;/span> &lt;span style="color:#75715e"># Add/Modify RSS template here&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">│   └── categories/&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">│      └── rss.xml &lt;/span> &lt;span style="color:#75715e"># Add/Modify RSS template here&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">│&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">├── docs/ &lt;/span> &lt;span style="color:#75715e"># change &amp;#39;public&amp;#39; to &amp;#39;docs&amp;#39; in /config.toml&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">│   ├── index.html&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">│   ├── index.xml&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">│   ├── home/&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">│   ├── post/&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">│   │   ├── index.xml &lt;/span> &lt;span style="color:#75715e"># set in &amp;#39;/layouts/post/rss.xml&amp;#39; &lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">│   │   ├── index.html&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">│   │   ├── 2015-07-23-r-rmarkdown/&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">│   │   └── 2015-07-23-r-rmarkdown_files/&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">│   └── categories/&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">│      └── r/&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">│      ├── index.xml &lt;/span> &lt;span style="color:#75715e"># set in &amp;#39;/layouts/categories/rss.xml&amp;#39; &lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">│      └── index.html&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">└── themes/&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">└── hugo-academic/&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="source-code">Source Code&lt;/h3>
&lt;p>You can check out the complete directory at &lt;a href="https://github.com/liao961120/Hugo-RSS">GitHub&lt;/a> and the &lt;a href="https://liao961120.github.io/Hugo-RSS/">web page&lt;/a> generated from this repo.&lt;/p>
&lt;div class="footnotes" role="doc-endnotes">
&lt;hr>
&lt;ol>
&lt;li id="fn:1">
&lt;p>For Jekyll blogs, creating a new RSS feed is just like creating a new page in the blog, and one can even use custom file names for RSS template files (such as &lt;a href="https://github.com/liao961120/blog/blob/master/feed.rbloggers.xml">feed.rbloggers.xml&lt;/a>).&amp;#160;&lt;a href="#fnref:1" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;li id="fn:2">
&lt;p>See &lt;a href="https://gohugo.io/templates/rss/">https://gohugo.io/templates/rss/&lt;/a> for more information.&amp;#160;&lt;a href="#fnref:2" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;li id="fn:3">
&lt;p>I have to admit that I don&amp;rsquo;t completely understand Hugo&amp;rsquo;s RSS template look up order. I can&amp;rsquo;t predict the behaviors of Hugo precisely.&amp;#160;&lt;a href="#fnref:3" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;/div></description><category>Web Page</category><category>blogdown</category><category>R-bloggers</category></item><item><title>Making Jekyll Blog Suitable for R-bloggers</title><link>https://yongfu.name/2018/08/02/rblogger-criteria/</link><pubDate>Thu, 02 Aug 2018 00:00:00 +0000</pubDate><guid>https://yongfu.name/2018/08/02/rblogger-criteria/</guid><description>&lt;/p>
&lt;p>Two reasons make it difficult:&lt;/p>
&lt;ol style="list-style-type: decimal">
&lt;li>&lt;blockquote>
&lt;p>The &lt;strong>feed&lt;/strong> you submit &lt;strong>should ONLY be about R&lt;/strong> (e.g: with R code, or directly related to the R world/community).&lt;/p>
&lt;/blockquote>
&lt;ul>
&lt;li>This causes problem because most bloggers write posts spanning several topics, and some blogging platform doesn’t support RSS feed for a particular category of posts.&lt;/li>
&lt;/ul>&lt;/li>
&lt;li>&lt;blockquote>
&lt;p>Make sure the HTML of your feed’s content is well formatted – otherwise it would not be able to load on r-bloggers. This includes to NOT copy-pasting from RStudio’s notebook extension – the feed &lt;strong>should NOT include “base64” images&lt;/strong>, make sure your images are saved as png or similar file formats.&lt;/p>
&lt;/blockquote>
&lt;ul>
&lt;li>For posts written with &lt;a href="https://rmarkdown.rstudio.com">R Markdown&lt;/a> and &lt;a href="https://rmarkdown.rstudio.com/html_fragment_format.html">HTML Fragment&lt;/a> output format, the embedded images generated from code chunks (such as outputs from &lt;code>plot()&lt;/code>) are &lt;strong>base64 images&lt;/strong>.&lt;/li>
&lt;/ul>&lt;/li>
&lt;/ol>
&lt;div id="fixing-the-first-problem" class="section level2">
&lt;h2>Fixing the First Problem&lt;/h2>
&lt;p>For &lt;strong>Jekyll&lt;/strong> sites using &lt;a href="https://github.com/jekyll/jekyll-feed">jekyll-feed&lt;/a> plugin to generate sitemaps, it is not possible to have RSS feed for a particular tag or category of posts. However there’s a workaround using &lt;strong>Jekyll&lt;/strong>’s &lt;a href="https://shopify.github.io/liquid/">Liquid syntax&lt;/a> to write an RSS template, as indicated by &lt;a href="https://devblog.dymel.pl/2017/02/09/category-rss-feed-in-jekyll/">this post&lt;/a>. I modified the template to make it suitable for the criteria set by R-bloggers, you can take a look at the file &lt;a href="https://github.com/liao961120/blog/blob/master/feed.rbloggers.xml">feed.rbloggers.xml&lt;/a>.&lt;/p>
&lt;/div>
&lt;div id="fixing-the-second-problem" class="section level2">
&lt;h2>Fixing the Second Problem&lt;/h2>
&lt;p>To fix the second problem, set &lt;code>self_contained: false&lt;/code> in the yaml header of the R Markdown document. With this setting, plots from code chunks are automatically generated in a figure directory, and the &lt;code>.html&lt;/code> output uses &lt;code>&amp;lt;img&amp;gt;&lt;/code> tags to source the plots in that figure directory.&lt;/p>
&lt;pre class="yaml">&lt;code>---
output:
html_fragment:
self_contained: false
---&lt;/code>&lt;/pre>
&lt;p>However, this creates a problem since the relative path in the &lt;code>&amp;lt;img&amp;gt;&lt;/code> tags probably won’t work in the remote directory that hosts your site. To overcome this problem, you have to &lt;strong>change the default figure directory&lt;/strong> and &lt;strong>post-process the output &lt;code>.html&lt;/code> file&lt;/strong>.&lt;/p>
&lt;p>For example, the source of this post(&lt;code>rblogger-criteria.rmd&lt;/code>) is two layers under the root dir of the web site.&lt;/p>
&lt;pre>&lt;code class="nohighlight">+---assets/
| +---rblogger-criteria-img/
+---_includes/
+---_plugins/
+---_posts/
+---post_source/
| +---rblogger-criteria/
| | +---rblogger-criteria.rmd
| | +---rblogger-criteria.html
+---index.html
+---_config.yml&lt;/code>&lt;/pre>
&lt;p>I set my figure directory to &lt;code>assets/rblogger-criteria-img/&lt;/code>:&lt;/p>
&lt;pre>&lt;code class="r">```{r setup, include=FALSE}
knitr::opts_chunk$set(
fig.path = &amp;quot;../..https://img.yongfu.name/assets/rblogger-criteria-img/&amp;quot;
)
```&lt;/code>&lt;/pre>
&lt;p>so when the site is rendered, the image would be in &lt;code>https://liao961120.github.io/assets/rblogger-criteria-img/&lt;/code>&lt;/p>
&lt;p>The last thing to do is processing the output &lt;code>rblogger-criteria.html&lt;/code> and replacing &lt;code>&amp;lt;img src=&amp;quot;../../assets&lt;/code> with &lt;code>&amp;lt;img src=&amp;quot;/assets&lt;/code> in the &lt;code>&amp;lt;img&amp;gt;&lt;/code> tag. I do this with a simple bash script:&lt;/p>
&lt;pre>&lt;code class="bash">sed &amp;quot;s#&amp;lt;img src=\&amp;quot;../../assets#&amp;lt;img src=\&amp;quot;/assets#g&amp;quot; rblogger-criteria.html &amp;gt; temp
cat temp &amp;gt; rblogger-criteria.html&lt;/code>&lt;/pre>
&lt;/div>
&lt;div id="a-demo" class="section level2">
&lt;h2>A Demo&lt;/h2>
&lt;p>Below is a plot generated from an R Markdown code chunk, you can look at the path in &lt;code>&amp;lt;img&amp;gt;&lt;/code> tag with the developer’s tool or the &lt;a href="https://img.yongfu.name/assets/rblogger-criteria-img/iris-1.png">image source&lt;/a> to confirm the path of the image is just as mentioned above.&lt;/p>
&lt;pre>&lt;code class="r">library(ggplot2)
ggplot(iris, aes(Sepal.Length, Petal.Width)) +
geom_point(aes(color = Species))&lt;/code>&lt;/pre>
&lt;p>&lt;img src="https://img.yongfu.name/assets/rblogger-criteria-img/iris-1.png" width="100%" />&lt;/p>
&lt;/div>
&lt;p style="text-align:right;font-size:7px;margin-top:0px;margin-bottom:0px;padding-top:0px;padding-bottom:1px">
&lt;a href="https://www.r-bloggers.com/">Visit R-bloggers&lt;/a>&lt;br>
Last updated: 2018-11-07
&lt;/p></description><category>R-bloggers</category><category>Jekyll</category><category>R Markdown</category><category>Web Page</category></item><item><title>google 表單即時回饋</title><link>https://yongfu.name/2018/04/20/gsheet_survey/</link><pubDate>Fri, 20 Apr 2018 00:00:00 +0000</pubDate><guid>https://yongfu.name/2018/04/20/gsheet_survey/</guid><description>&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;p>google 表單大幅降低蒐集問卷資料的難度；此外，表單將回應&lt;strong>自動彙整成試算表&lt;/strong>更使分析資料變得非常容易。然而，google 表單缺乏一項重要的功能：&lt;strong>即時將結果回饋給填寫者&lt;/strong>&lt;sup id="fnref:1">&lt;a href="#fn:1" class="footnote-ref" role="doc-noteref">1&lt;/a>&lt;/sup>。&lt;/p>
&lt;p>讓問卷填寫者能馬上知道結果，可以增加其填寫意願，同時也是負責的態度(在回饋不會造成負面影響的前提下)。當然，這在 google 表單本身的限制下無法達成。以下將介紹如何結合 &lt;strong>google 試算表&lt;/strong> 以及 &lt;strong>&lt;a href="https://github.com/datacamp/datacamp-light">DataCamp Light&lt;/a>&lt;/strong>，讓任何人都能製作出一個在&lt;strong>靜態網頁&lt;/strong>上運行的平台，&lt;strong>使填寫者能在此填寫問卷、查詢結果&lt;/strong>。&lt;/p>
&lt;h2 id="實際操作">實際操作&lt;/h2>
&lt;p>繼續閱讀下去前，可先至&lt;a href="https://img.yongfu.name/assets/gsheet_post/demo/">回饋功能示範平台&lt;/a>操作看看，比較容易理解下文內容。文章中的說明即是依據此&lt;strong>回饋功能示範平台&lt;/strong>。&lt;/p>
&lt;h2 id="概觀-運作邏輯">概觀: 運作邏輯&lt;/h2>
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;p>上圖的每個方塊(除了左圖的&lt;strong>試算表&lt;/strong>)名稱，皆對應到&lt;strong>回饋功能示範平台&lt;/strong>背後運作的檔案。圖需要分&lt;strong>左&lt;/strong>、&lt;strong>右&lt;/strong>來看：&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;strong>左側&lt;/strong>以使用者觀點為中心，顯示使用者填寫問卷(送出資料)到獲得回饋之間，資料流動的路程。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>右側&lt;/strong>的流程圖，實際上是左圖&lt;strong>試算表&lt;/strong>(表單、DataCamp之間)那格的完整路程，意即資料在 google 試算表間的流動及運算。使用者獲得的回饋即是由這些試算表的運算產生。&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>回饋功能&lt;/strong>運作的邏輯其實非常簡單：在問卷送出後，透過 &lt;strong>google 試算表&lt;/strong>處理資料(運算、整理)；接著透過 &lt;strong>DataCamp light&lt;/strong> 執行預先寫入的 R 語言，讀取經 &lt;strong>google 試算表&lt;/strong>處理後的資料；最後使用者輸入查詢金鑰(於問卷中填寫)，篩選出那筆自己填寫的資料。&lt;/p>
&lt;p>以下，說明如何設置問卷回饋系統的各個成分，並使用此&lt;a href="https://drive.google.com/open?id=16lRn7UUo_-8OUdfaYrg7CSUNIvOAmAM8">資料夾&lt;/a>中的檔案說明。檔案間的關係完全對應至上文&lt;strong>概觀&lt;/strong>中的&lt;a href="#mermaidChart0">概念圖&lt;/a>，亦即&lt;strong>問卷回饋平台&lt;/strong>背後蒐集及運算資料所使用到的檔案。下方的說明，單純閱讀文字會難以理解。若有打算實作，可實際打開資料夾中的檔案以配合閱讀，或甚至完全自己重複文中的步驟。&lt;/p>
&lt;h2 id="表單試算表-設置">表單、試算表 設置&lt;/h2>
&lt;p>這節將設置&lt;strong>問卷回饋平台&lt;/strong>的&lt;strong>資料蒐集與運算功能&lt;/strong>，包含 1 個 google 表單(&lt;code>表單&lt;/code>)及 3 個 google 試算表(&lt;code>表單回應&lt;/code>, &lt;code>運算分析&lt;/code>, &lt;code>結果查找&lt;/code>)。&lt;/p>
&lt;h3 id="連結表單至試算表">連結表單至試算表&lt;/h3>
&lt;p>這項功能使用過 google 表單的人都知道，可參考 &lt;a href="https://support.google.com/docs/answer/2917686?hl=zh-Hant">google 說明&lt;/a>，以下簡單說明：&lt;/p>
&lt;p>從雲端硬碟進入到表單後，即會顯示下圖的頁面(需具編輯權限)。注意需於&lt;strong>中間白色方塊&lt;/strong>點選「&lt;strong>回覆&lt;/strong>」，畫面才會如下圖(預設畫面是「問題」)。&lt;/p>
&lt;p>
&lt;img src="https://img.yongfu.name/assets/gsheet_post/linksheet.PNG" alt="">
&lt;/p>
&lt;p>接著點選白色方塊右上方的綠色 icon，即會出現 2 個選項：&lt;/p>
&lt;ul>
&lt;li>建立新試算表，並命名。 (預設名稱為「無標題表單 (回應)」)&lt;/li>
&lt;li>選取現有的試算表&lt;/li>
&lt;/ul>
&lt;p>選擇建立新的試算表。&lt;br>
點選建立後，即會在與表單相同的資料夾中建立試算表，我將其命名為&lt;strong>表單回應&lt;/strong>(即&lt;strong>概觀&lt;/strong>中&lt;a href="#mermaidChart0">右圖&lt;/a>的&lt;code>表單回應&lt;/code>)。&lt;br>
此後，每當有人填完問卷，&lt;code>表單回應&lt;/code>即會自動新增一列(row)資料。&lt;/p>
&lt;h3 id="試算表間的連結-importrange">試算表間的連結: &lt;code>IMPORTRANGE&lt;/code>&lt;/h3>
&lt;p>&lt;strong>千萬不能編輯&lt;code>表單回應&lt;/code>&lt;/strong>，這可能會破壞收集到的問卷資料。google 試算表有一個很實用的函數&lt;code>IMPORTRANGE&lt;/code>，能夠選取一試算表中特定的範圍，將其連結至另一獨立的試算表中(獨立檔案)。因此，每當原先的試算表更新，透過&lt;code>IMPORTRANGE&lt;/code>連結的新試算表也會跟著更新。如此，即可在不更動&lt;code>表單回應&lt;/code>下，對&lt;code>表單回應&lt;/code>的內容進行運算。&lt;/p>
&lt;p>若此文關於&lt;code>IMPORTRANGE&lt;/code>有描述不清的地方，可參考&lt;a href="http://isvincent.pixnet.net/blog/post/46090834-excel-google%E8%A9%A6%E7%AE%97%E8%A1%A8%E5%A6%82%E4%BD%95%E9%97%9C%E8%81%AF%E5%88%B0%E5%8F%A6%E4%B8%80%E5%80%8B%E8%A9%A6%E7%AE%97%E8%A1%A8%E7%9A%84%E5%85%A7">這篇&lt;/a>寫得相當清楚的文章。
{: .info}&lt;/p>
&lt;pre tabindex="0">&lt;code class="language-vbscript" data-lang="vbscript">IMPORTRANGE(&amp;#34;&amp;lt;URL&amp;gt;&amp;#34;, &amp;#34;&amp;lt;工作表名稱&amp;gt;!&amp;lt;儲存格範圍&amp;gt;&amp;#34;)
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>&lt;code>&amp;lt;URL&amp;gt;&lt;/code>: 所欲匯入資料之試算表的網址，在此為&lt;code>表單回應&lt;/code>之URL&lt;/li>
&lt;li>&lt;code>&amp;lt;工作表名稱&amp;gt;&lt;/code>: &lt;code>表單回應&lt;/code>只有一個工作表，將其名稱填入這裡。&lt;/li>
&lt;li>&lt;code>&amp;lt;儲存格範圍&amp;gt;&lt;/code>: 儲存格範圍視問卷的題數與筆數而定，其格式為：&lt;code>A1:F9999&lt;/code>。大寫字母代表欄位，一個欄位即為問卷上的一題；字母後面的數字是列數，一筆資料(一份問卷)佔有一列(row)。&lt;/li>
&lt;/ul>
&lt;h3 id="運算分析試算表">**&lt;code>運算分析&lt;/code>**試算表&lt;/h3>
&lt;h4 id="匯入">匯入&lt;/h4>
&lt;p>在&lt;a href="https://docs.google.com/spreadsheets/d/1znFpdD_Kt1Jk274l0yD1dGZZyhsh7m1Xji9IYZUigEU/edit#gid=0">&lt;code>運算分析&lt;/code>&lt;/a>中的儲存格&lt;code>A1&lt;/code>，我輸入了以下公式：&lt;/p>
&lt;pre tabindex="0">&lt;code class="language-vbscript" data-lang="vbscript">=IMPORTRANGE(&amp;#34;https://docs.google.com/spreadsheets/d/1-eOAbpOZ1aeuNUHo3b0olLTrheq-T-pe2BsRXK-P-mM/edit#gid=579070166&amp;#34;, &amp;#34;表單回應 1!A1:E9999&amp;#34;)
&lt;/code>&lt;/pre>&lt;p>以匯入&lt;a href="https://docs.google.com/spreadsheets/d/1-eOAbpOZ1aeuNUHo3b0olLTrheq-T-pe2BsRXK-P-mM/edit#gid=579070166">&lt;code>表單回應&lt;/code>&lt;/a>的 A 至 E 欄&lt;sup id="fnref:2">&lt;a href="#fn:2" class="footnote-ref" role="doc-noteref">2&lt;/a>&lt;/sup>。&lt;/p>
&lt;h4 id="運算公式">運算公式&lt;/h4>
&lt;p>我在 G 欄設定公式計算 Q1, Q2, Q3 的分數總合，其中 &lt;strong>Q3 是反向計分&lt;/strong>。&lt;/p>
&lt;h4 id="時間戳記">時間戳記&lt;/h4>
&lt;p>由於之後會透過 DataCamp Light 讀取 google 試算表，但其並不支援&lt;strong>英文以外的文字&lt;/strong>，因此需&lt;strong>將試算表的格式改為英文&lt;/strong>：&lt;/p>
&lt;p>選擇試算表 &lt;code>檔案&lt;/code> &amp;gt; &lt;code>試算表設定&lt;/code> &amp;gt; &lt;code>一般&lt;/code>:&lt;/p>
&lt;ul>
&lt;li>語言代碼: &lt;code>美國&lt;/code>&lt;/li>
&lt;li>時區: &lt;code>(GMT+08:00) Taipei&lt;/code>&lt;sup id="fnref:3">&lt;a href="#fn:3" class="footnote-ref" role="doc-noteref">3&lt;/a>&lt;/sup>&lt;/li>
&lt;/ul>
&lt;p>更改完試算表語言後，需更改&lt;strong>時間戳記&lt;/strong>的格式&lt;sup id="fnref:4">&lt;a href="#fn:4" class="footnote-ref" role="doc-noteref">4&lt;/a>&lt;/sup>：&lt;/p>
&lt;ol>
&lt;li>選擇時間戳記那欄(在此為 A 欄)&lt;/li>
&lt;li>&lt;code>格式&lt;/code> &amp;gt; &lt;code>數值&lt;/code> &amp;gt; &lt;code>日期時間&lt;/code>&lt;/li>
&lt;/ol>
&lt;h3 id="結果查找試算表">**&lt;code>結果查找&lt;/code>**試算表&lt;/h3>
&lt;p>&lt;code>運算分析&lt;/code>設置完成之後，需要&lt;strong>選擇希望使用者查詢時，能看到的項目&lt;/strong>:&lt;/p>
&lt;ol>
&lt;li>&lt;strong>時間戳記&lt;/strong>: A 欄&lt;/li>
&lt;li>&lt;strong>Token&lt;/strong>: E 欄&lt;/li>
&lt;li>&lt;strong>score&lt;/strong>: G 欄&lt;/li>
&lt;/ol>
&lt;p>因此，需將&lt;code>結果查找&lt;/code>中的 A、B、C 欄分別對應到&lt;code>運算分析&lt;/code>中的 A、E、G 欄。在&lt;code>結果查找&lt;/code>的儲存格&lt;code>A1&lt;/code>、&lt;code>B1&lt;/code>、&lt;code>C1&lt;/code>，分別使用&lt;code>IMPORTRANGE&lt;/code>：&lt;/p>
&lt;ol>
&lt;li>儲存格&lt;code>A1&lt;/code>&lt;/li>
&lt;/ol>
&lt;pre tabindex="0">&lt;code class="language-vbscript" data-lang="vbscript">=IMPORTRANGE(&amp;#34;https://docs.google.com/spreadsheets/d/1znFpdD_Kt1Jk274l0yD1dGZZyhsh7m1Xji9IYZUigEU/edit#gid=0&amp;#34;, &amp;#34;工作表1!A1:A9999&amp;#34;)
&lt;/code>&lt;/pre>&lt;ol start="2">
&lt;li>儲存格&lt;code>B1&lt;/code>&lt;/li>
&lt;/ol>
&lt;pre tabindex="0">&lt;code class="language-vbscript" data-lang="vbscript">=IMPORTRANGE(&amp;#34;https://docs.google.com/spreadsheets/d/1znFpdD_Kt1Jk274l0yD1dGZZyhsh7m1Xji9IYZUigEU/edit#gid=0&amp;#34;, &amp;#34;工作表1!E1:E9999&amp;#34;)
&lt;/code>&lt;/pre>&lt;ol start="3">
&lt;li>儲存格&lt;code>C1&lt;/code>&lt;/li>
&lt;/ol>
&lt;pre tabindex="0">&lt;code class="language-vbscript" data-lang="vbscript">=IMPORTRANGE(&amp;#34;https://docs.google.com/spreadsheets/d/1znFpdD_Kt1Jk274l0yD1dGZZyhsh7m1Xji9IYZUigEU/edit#gid=0&amp;#34;, &amp;#34;工作表1!G1:G9999&amp;#34;)
&lt;/code>&lt;/pre>&lt;h2 id="datacamp-light-設置">DataCamp Light 設置&lt;/h2>
&lt;p>&lt;a href="https://www.datacamp.com/">DataCamp&lt;/a> 是一個學習資料科學程式語言的線上教學網站，有 R 和 Python 的教學。&lt;a href="https://github.com/datacamp/datacamp-light">DataCamp Light&lt;/a> 是一個互動式的程式語言輔助教學工具。其能夠鑲嵌在網頁上，讓使用者直接透過網頁學習 R 或 Python。&lt;/p>
&lt;p>
&lt;img src="https://img.yongfu.name/assets/gsheet_post/DataCamp.PNG" alt="">
&lt;/p>
&lt;p>這裡即透過 DataCamp 執行預先寫入的 R Script，讀取儲存在雲端的&lt;code>結果查找&lt;/code>。使用者在 DataCamp Light 輸入的&lt;code>Token&lt;/code>是用來篩選資料，以回傳使用者填寫的那筆問卷。&lt;/p>
&lt;h3 id="取得試算表權限">取得試算表權限&lt;/h3>
&lt;p>DataCamp Light 讀取的是&lt;code>結果查找&lt;/code>的內容，因此需將&lt;code>結果查找&lt;/code>需將&lt;code>結果查找&lt;/code>透過連結&lt;strong>分享&lt;/strong>&lt;sup id="fnref:5">&lt;a href="#fn:5" class="footnote-ref" role="doc-noteref">5&lt;/a>&lt;/sup>至網路:&lt;/p>
&lt;p>開啟&lt;code>結果查找&lt;/code>，選取右上角藍色按鍵&lt;strong>共用&lt;/strong>即會開啟下圖中的小視窗：&lt;/p>
&lt;p>
&lt;img src="https://img.yongfu.name/assets/gsheet_post/release_csv.PNG" alt="">
&lt;/p>
&lt;p>接著，&lt;/p>
&lt;ol>
&lt;li>選取「知道連結的人均&lt;strong>可以檢視&lt;/strong>」(注意&lt;strong>不要選到可以編輯&lt;/strong>)&lt;/li>
&lt;li>複製連結&lt;/li>
&lt;li>按下方「完成」&lt;/li>
&lt;/ol>
&lt;h3 id="完整程式碼">完整程式碼&lt;/h3>
&lt;p>以下是&lt;a href="https://img.yongfu.name/assets/gsheet_post/demo/">回饋功能示範平台&lt;/a>的 DataCamp Light 程式碼(html)：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;script&lt;/span> &lt;span style="color:#a6e22e">src=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;https://cdn.datacamp.com/datacamp-light-latest.min.js&amp;#34;&lt;/span>&lt;span style="color:#f92672">&amp;gt;&amp;lt;/script&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;div&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">data-datacamp-exercise&lt;/span> &lt;span style="color:#a6e22e">data-lang=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;r&amp;#34;&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;code&lt;/span> &lt;span style="color:#a6e22e">data-type=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;pre-exercise-code&amp;#34;&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> library(googlesheets)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> data &lt;span style="color:#f92672">&amp;lt;-&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">gs_read(gs_url(&amp;#34;https://docs.google.com/spreadsheets/d/1ufuzTL9VCxdvX1QeFQcMGxYbEMq1ZEWVht3CEDpXBmc/edit?&lt;/span>&lt;span style="color:#a6e22e">usp=&lt;/span>&lt;span style="color:#e6db74">sharing&amp;#34;))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">data&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">&amp;lt;-&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">as.data.frame(data)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">colnames(data)&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">&amp;lt;-&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">c(&amp;#34;DateTime&amp;#34;,&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">&amp;#34;Token&amp;#34;,&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">&amp;#34;Score&amp;#34;)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">data&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">&amp;lt;-&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">data[which(!is.na(data$DateTime)),]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">score&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">&amp;lt;-&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">function(token)&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">i&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">&amp;lt;-&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">which(data$&lt;/span>&lt;span style="color:#a6e22e">Token =&lt;/span>&lt;span style="color:#e6db74">=&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">token)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">data[i,]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">&amp;lt;/code&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;code&lt;/span> &lt;span style="color:#a6e22e">data-type=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;sample-code&amp;#34;&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> # Put Token in &amp;#34;&amp;#34;. Ex: score(&amp;#34;abcde123&amp;#34;)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> score(&amp;#34;Enter_your_Token&amp;#34;)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/code&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;/div&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>下面將分別說明這些程式碼的意義。&lt;/p>
&lt;p>&lt;strong>注意&lt;/strong>&lt;br>
DataCamp Light &lt;strong>僅能正常顯示英文&lt;/strong>，因此需確定 R Script 以及使用者填入的 Token 皆沒有多位元組字(例如，中文)。
{: .error}&lt;/p>
&lt;h3 id="預先執行程式碼">預先執行程式碼&lt;/h3>
&lt;p>下面為&lt;code>&amp;lt;code data-type=&amp;quot;pre-exercise-code&amp;quot;&amp;gt;...&amp;lt;/code&amp;gt;&lt;/code>之間的程式碼&lt;br>
此段程式碼是使用者看不到，但會預先執行的 R Script，其中可分成 3 個部分：&lt;strong>讀取資料&lt;/strong>、&lt;strong>資料刪減&lt;/strong>、&lt;strong>查找函數&lt;/strong>。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-R" data-lang="R">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">library&lt;/span>(googlesheets)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>data &lt;span style="color:#f92672">&amp;lt;-&lt;/span> &lt;span style="color:#a6e22e">gs_read&lt;/span>(&lt;span style="color:#a6e22e">gs_url&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;https://docs.google.com/spreadsheets/d/1ufuzTL9VCxdvX1QeFQcMGxYbEMq1ZEWVht3CEDpXBmc/edit?usp=sharing&amp;#34;&lt;/span>))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>data &lt;span style="color:#f92672">&amp;lt;-&lt;/span> &lt;span style="color:#a6e22e">as.data.frame&lt;/span>(data)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">colnames&lt;/span>(data) &lt;span style="color:#f92672">&amp;lt;-&lt;/span> &lt;span style="color:#a6e22e">c&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;DateTime&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;Token&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;Score&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>data &lt;span style="color:#f92672">&amp;lt;-&lt;/span> data&lt;span style="color:#a6e22e">[which&lt;/span>(&lt;span style="color:#f92672">!&lt;/span>&lt;span style="color:#a6e22e">is.na&lt;/span>(data&lt;span style="color:#f92672">$&lt;/span>DateTime)),]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>score &lt;span style="color:#f92672">&amp;lt;-&lt;/span> &lt;span style="color:#a6e22e">function&lt;/span>(token) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> i &lt;span style="color:#f92672">&amp;lt;-&lt;/span> &lt;span style="color:#a6e22e">which&lt;/span>(data&lt;span style="color:#f92672">$&lt;/span>Token &lt;span style="color:#f92672">==&lt;/span> token)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> data[i,]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="讀取資料">讀取資料&lt;/h4>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-R" data-lang="R">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">library&lt;/span>(googlesheets)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>data &lt;span style="color:#f92672">&amp;lt;-&lt;/span> &lt;span style="color:#a6e22e">gs_read&lt;/span>(&lt;span style="color:#a6e22e">gs_url&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;https://docs.google.com/spreadsheets/...&amp;#34;&lt;/span>))
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>上面這段程式碼透過雲端讀取&lt;code>結果查找&lt;/code>，並將其儲存於變項&lt;code>data&lt;/code>。函數內的連結即是上面在設置&lt;code>結果查找&lt;/code>的讀取權限時的共用分享連結。&lt;/p>
&lt;h4 id="資料刪減">資料刪減&lt;/h4>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-R" data-lang="R">&lt;span style="display:flex;">&lt;span>data &lt;span style="color:#f92672">&amp;lt;-&lt;/span> &lt;span style="color:#a6e22e">as.data.frame&lt;/span>(data)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">colnames&lt;/span>(data) &lt;span style="color:#f92672">&amp;lt;-&lt;/span> &lt;span style="color:#a6e22e">c&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;DateTime&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;Token&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;Score&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>data &lt;span style="color:#f92672">&amp;lt;-&lt;/span> data&lt;span style="color:#a6e22e">[which&lt;/span>(&lt;span style="color:#f92672">!&lt;/span>&lt;span style="color:#a6e22e">is.na&lt;/span>(data&lt;span style="color:#f92672">$&lt;/span>DateTime)),]
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>上面的程式碼做了 3 件事(1 行 1 件事)：&lt;/p>
&lt;ol>
&lt;li>將&lt;code>data&lt;/code>轉變成 base R 的&lt;code>data.frame&lt;/code>。由&lt;code>readr::read_csv&lt;/code>讀進來的&lt;code>data.frame&lt;/code>會是&lt;code>tibble&lt;/code>，而&lt;code>tibble&lt;/code>在 DataCamp Light 的 console 印出時，會顯示出幾項對使用者沒用的訊息(這是 R 給資料分析者看的)，但傳統的 base R &lt;code>data.frame&lt;/code>不會。&lt;/li>
&lt;li>第二行則是將資料中每一個變項的名稱，更改為 &lt;strong>DateTime&lt;/strong>(&lt;code>時間戳記&lt;/code>)、&lt;strong>Token&lt;/strong>(&lt;code>Token&lt;/code>)、&lt;strong>Score&lt;/strong>(&lt;code>Score&lt;/code>)。括號內的名稱是&lt;code>結果查找&lt;/code>內的變項名稱。&lt;/li>
&lt;li>第三行是用以刪減多餘的資料。由於在&lt;code>運算結果&lt;/code>套用公式時，勢必要為&lt;strong>未來&lt;/strong>的儲存格著想：預先套入公式，才能計算未來產生的資料，因此，讀入的資料大多數都是空白的，僅有&lt;code>Score&lt;/code>那欄為 6&lt;sup id="fnref:6">&lt;a href="#fn:6" class="footnote-ref" role="doc-noteref">6&lt;/a>&lt;/sup>。&lt;/li>
&lt;/ol>
&lt;h4 id="查找函數">查找函數&lt;/h4>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-R" data-lang="R">&lt;span style="display:flex;">&lt;span>score &lt;span style="color:#f92672">&amp;lt;-&lt;/span> &lt;span style="color:#a6e22e">function&lt;/span>(token) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> i &lt;span style="color:#f92672">&amp;lt;-&lt;/span> &lt;span style="color:#a6e22e">which&lt;/span>(data&lt;span style="color:#f92672">$&lt;/span>Token &lt;span style="color:#f92672">==&lt;/span> token)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> data[i,]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>這是 DataCamp Light 在此最關鍵的功能。&lt;code>score()&lt;/code>是一函數，讓填寫者透過當初於問卷填寫的 Token ，查詢自己的問卷回饋&lt;sup id="fnref:7">&lt;a href="#fn:7" class="footnote-ref" role="doc-noteref">7&lt;/a>&lt;/sup>。該函數的功能，即是在&lt;code>data&lt;/code>中的&lt;code>Token&lt;/code>變項，尋找符合使用者輸入的值，並將符合的資料印在 console 上。&lt;/p>
&lt;h3 id="顯示程式碼">顯示程式碼&lt;/h3>
&lt;p>下面為&lt;code>&amp;lt;code data-type=&amp;quot;sample-code&amp;quot;&amp;gt;...&amp;lt;/code&amp;gt;&lt;/code>之間的程式碼，是使用者看的到的 R Script：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-r" data-lang="r">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># Put Token in &amp;#34;&amp;#34;. Ex: score(&amp;#34;abcde123&amp;#34;)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">score&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;Enter_your_Token&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>第一行是註解(同一行中，&lt;code>#&lt;/code>之後的內容不會執行)，可用來說明。&lt;br>
第二行預先印出&lt;code>score()&lt;/code>函數，讓使用者僅需輸入 Token 而不需自行打出函數。&lt;/p>
&lt;h2 id="靜態網頁-設置">靜態網頁 設置&lt;/h2>
&lt;p>對於完全沒有概念的人，設置靜態網頁可能會是比較困難的部分，因為多數人對此相當陌生。靜態網頁在此的目的是為了讓 DataCamp Light 的程式碼(即一段 HTML)能夠運行，因此若讀者使用的部落格平台允許自由變更網頁的 html 並且能自由匯入 JS&lt;sup id="fnref:8">&lt;a href="#fn:8" class="footnote-ref" role="doc-noteref">8&lt;/a>&lt;/sup>，則可以忽略此節內容。&lt;/p>
&lt;h3 id="github-pages">GitHub Pages&lt;/h3>
&lt;p>架設靜態網頁&lt;sup id="fnref:9">&lt;a href="#fn:9" class="footnote-ref" role="doc-noteref">9&lt;/a>&lt;/sup>並非難事，難的是做出漂亮的靜態網頁。然而，網頁越漂亮，其結構通常也更加複雜。如何(短時間)打造美觀的靜態網頁以及基礎 HTML, CSS 的概念並非此文的目的。對於有這些需求的讀者，我推薦 &lt;a href="https://yihui.name/">Yihui Xie&lt;/a> 的 &lt;a href="https://bookdown.org/yihui/blogdown/">blogdown&lt;/a>。&lt;/p>
&lt;p>以下提供一個最精簡的例子，由註冊 GitHub 帳號到架設網頁，過程中僅需使用到瀏覽器(GUI)，不需用到 Git。&lt;/p>
&lt;h4 id="註冊與建立-repo">註冊與建立 Repo&lt;/h4>
&lt;ol>
&lt;li>
&lt;p>至 &lt;a href="https://github.com/">https://github.com/&lt;/a> ，填寫註冊資訊(一個 email 僅能註冊一次)，並記得去信箱認證。&lt;strong>Username&lt;/strong> 即為之後網站的網址，以下圖為例，minimalghpage.github.io。&lt;/p>
&lt;p>
&lt;img src="https://img.yongfu.name/assets/gsheet_post/github_signup.PNG" alt="">
&lt;/p>
&lt;/li>
&lt;li>
&lt;p>信箱認證後，將自動跳回 GitHub 頁面。之後，基本上不需更動出現之畫面的設定，只要按下一步。最後應會出現下圖，按右上角圖示並選取 &lt;strong>Your Profile&lt;/strong>。&lt;/p>
&lt;p>
&lt;figure>
&lt;img src="https://img.yongfu.name/assets/gsheet_post/gh_main.PNG" alt="account info">
&lt;figcaption>account info&lt;/figcaption>
&lt;/figure>
&lt;/p>
&lt;/li>
&lt;li>
&lt;p>按下網頁中上方的 &lt;strong>Repositories&lt;/strong> 後應會出現下圖，接著再按下右上方的綠色按鈕 &lt;strong>New&lt;/strong>。&lt;/p>
&lt;p>
&lt;img src="https://img.yongfu.name/assets/gsheet_post/gh_repo.PNG" alt="">
&lt;/p>
&lt;/li>
&lt;li>
&lt;p>出現下圖後，在 &lt;strong>Repository name&lt;/strong> 輸入&lt;code>&amp;lt;username&amp;gt;.github.io&lt;/code>(&lt;code>&amp;lt;username&amp;gt;&lt;/code>一定要與當初註冊時填入的 &lt;strong>Username&lt;/strong> 一模一樣)，並&lt;strong>勾選&lt;/strong>下方 &lt;strong>Initialize this repository with a README&lt;/strong>。最後按 &lt;strong>Create repository&lt;/strong>。&lt;/p>
&lt;p>
&lt;img src="https://img.yongfu.name/assets/gsheet_post/create_repo.PNG" alt="">
&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h4 id="上傳網頁">上傳網頁&lt;/h4>
&lt;ol>
&lt;li>
&lt;p>&lt;a href="https://minhaskamal.github.io/DownGit/#/home?url=https://github.com/liao961120/local_depend/tree/master/minimal_web_DataCampLight">下載&lt;/a> &lt;strong>Minimal Web Page&lt;/strong> (下載後需解壓縮。)&lt;/p>
&lt;/li>
&lt;li>
&lt;p>至剛剛建立的 Repository (&lt;code>&amp;lt;username&amp;gt;.github.io&lt;/code>)，點擊 &lt;strong>Upload files&lt;/strong> (圖中黃色螢光處)。&lt;/p>
&lt;p>
&lt;img src="https://img.yongfu.name/assets/gsheet_post/gh_upload.PNG" alt="">
&lt;/p>
&lt;/li>
&lt;li>
&lt;p>進入新畫面後，將&lt;code>index.html&lt;/code>, &lt;code>search.html&lt;/code>, &lt;code>.nojekyll&lt;/code>拖曳上傳，並按下畫面最下方 &lt;strong>Commit changes&lt;/strong>.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>上傳完成後，即可看到下圖。&lt;code>.nojekyll&lt;/code>不會顯示出來。&lt;/p>
&lt;p>
&lt;img src="https://img.yongfu.name/assets/gsheet_post/gh_uploaded.PNG" alt="">
&lt;/p>
&lt;/li>
&lt;li>
&lt;p>**完成！**過 1, 2 分鐘後，即可至&lt;code>&amp;lt;username&amp;gt;.github.io&lt;/code>檢視網頁。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>之後若要修改檔案，將修改過後的檔案依相同步驟上傳即可。&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h3 id="minimal-web-page">Minimal Web Page&lt;/h3>
&lt;p>&lt;a href="https://github.com/liao961120/local_depend/tree/master/minimal_web_DataCampLight">Minimal Web Page&lt;/a> 裡面有三個檔案：&lt;code>index.html&lt;/code>, &lt;code>search.html&lt;/code>, &lt;code>.nojekyll&lt;/code>。&lt;/p>
&lt;ul>
&lt;li>&lt;code>index.html&lt;/code>: 這是網站的首頁，亦即瀏覽器進入&lt;code>https://&amp;lt;username&amp;gt;.github.io/&lt;/code>時所讀取的檔案。此檔案內含 HTML 必要結構，並且匯入 &lt;a href="https://getbootstrap.com/docs/4.0/getting-started/introduction/">bootstrap&lt;/a> 的 CSS 和 JS 以快速製作漂亮的 Button 和 Modal。&lt;/li>
&lt;li>&lt;code>search.html&lt;/code>：這份檔案即為上文 DataCamp light 的&lt;a href="#%E5%AE%8C%E6%95%B4%E7%A8%8B%E5%BC%8F%E7%A2%BC">完整程式碼&lt;/a>，加上一些 HTML 的必要結構以及重新整理頁面的按鈕(Reload)。若需修改其中的 R Script，需用&lt;a href="https://zh.wikipedia.org/wiki/%E6%96%87%E6%9C%AC%E7%BC%96%E8%BE%91%E5%99%A8">文字編輯器&lt;/a>開啟此檔案修改&lt;code>&amp;lt;code&amp;gt;...&amp;lt;/code&amp;gt;&lt;/code>裡面的內容。&lt;/li>
&lt;li>&lt;code>.nojekyll&lt;/code>: &lt;a href="https://help.github.com/articles/using-jekyll-as-a-static-site-generator-with-github-pages/">Jekyll&lt;/a> 是 GitHub Pages 預設的靜態網頁產生器，能自動將 Markdown 生成&lt;code>.html&lt;/code>，對於常寫文章的使用者很方便：不需每次發文都要自己將文章轉為 html 檔。&lt;code>.nojekyll&lt;/code>在此的作用是告訴 GitHub Pages &lt;strong>不要使用 Jekyll 產生網頁&lt;/strong>，因為使用 Jekyll 產生網頁，repository 需符合特定的檔案格式與架構&lt;sup id="fnref:10">&lt;a href="#fn:10" class="footnote-ref" role="doc-noteref">10&lt;/a>&lt;/sup>。&lt;/li>
&lt;/ul>
&lt;h4 id="r-使用者">R 使用者&lt;/h4>
&lt;p>會用 Rmarkdown 的人，可直接&lt;a href="https://minhaskamal.github.io/DownGit/#/home?url=https://github.com/liao961120/blog/tree/masterhttps://img.yongfu.name/assets/gsheet_post/demo">下載&lt;/a>&lt;strong>回饋功能示範平台&lt;/strong>製作網頁(需額外安裝一些 package)，不須使用上述資料夾內的檔案。這能省下許多製作網頁(&lt;code>index.html&lt;/code>)的時間。&lt;/p>
&lt;p>R markdown 是 Markdown 的擴充，其輸出的 HTML 格式已經過簡單的排版，同時也支援 Bootstrap (&lt;strong>Minimal Web Page&lt;/strong> 裡的 HTML 也有匯入 Bootstrap)，因此能夠輕易地製作出&lt;strong>美觀&lt;/strong>的網頁。Rmarkdown 可輸出許多格式，其中 &lt;a href="https://rmarkdown.rstudio.com/html_document_format.html">html_document&lt;/a> 最為簡單。Rmarkdown 的語法(&lt;a href="https://www.rstudio.com/wp-content/uploads/2015/03/rmarkdown-reference.pdf">Cheat Sheet&lt;/a>)即為 Markdown 語法加上許多額外的功能(透過 R 實現)。&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;h2 id="隱私問題">隱私問題&lt;/h2>
&lt;p>在此需特別提醒問卷填寫者隱私的問題。由於查詢個人的問卷回饋需透過 DataCamp Light，其&lt;strong>由雲端讀取之試算表(&lt;code>結果查找&lt;/code>)是公開的&lt;/strong>。縱使網頁表面看不見&lt;code>結果查找&lt;/code>的網址，但只要檢視網頁的原始碼(透過瀏覽器的開發人員工具，或至 GitHub 直接下載&lt;code>search.html&lt;/code>)，即可取得&lt;code>結果查找&lt;/code>的網址，並下載整份資料&lt;sup id="fnref:11">&lt;a href="#fn:11" class="footnote-ref" role="doc-noteref">11&lt;/a>&lt;/sup>。&lt;/p>
&lt;p>以這裡的例子說明，&lt;code>結果查找&lt;/code>僅含有 3 欄：時間戳記、Token、分數。這 3 欄是任何人都能看見的內容，其中 &lt;strong>Token 是由問卷填寫者直接填寫&lt;/strong>，因此&lt;/p>
&lt;p>在設計問卷時，需於 Token 那題特別提醒填寫者：&lt;strong>不能填寫能關聯到個人身份的內容，如學號、e-mail 等&lt;/strong>。&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;div class="footnotes" role="doc-endnotes">
&lt;hr>
&lt;ol>
&lt;li id="fn:1">
&lt;p>其實 google 表單確實能即時回饋分數，但僅限&lt;a href="https://support.google.com/docs/answer/7032287?hl=zh-Hant">測驗模式&lt;/a>，有諸多限制，例如，題目僅能為「對」或「錯」，無法處理反向計分的問題，無法使用線性刻度 (linear scale) 計分等。&amp;#160;&lt;a href="#fnref:1" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;li id="fn:2">
&lt;p>若擔心填答人數超過 9998 人，可設個更大的數字，如&lt;code>E99999&lt;/code>。&amp;#160;&lt;a href="#fnref:2" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;li id="fn:3">
&lt;p>你也可以設置時區，通常依據的是多數問卷填寫者所在位置的時區。這邊設為台北時間。&amp;#160;&lt;a href="#fnref:3" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;li id="fn:4">
&lt;p>這邊是為了方便之後 R parse 日期格式。&amp;#160;&lt;a href="#fnref:4" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;li id="fn:5">
&lt;p>這關係到隱私問題，詳見最後一節&lt;a href="#privacy">隱私問題&lt;/a>&amp;#160;&lt;a href="#fnref:5" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;li id="fn:6">
&lt;p>總分(Score) = 空白(Q1) + 空白(Q2) + 6(6 - Q3)。Q3 是反向計分的五點量尺。&amp;#160;&lt;a href="#fnref:6" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;li id="fn:7">
&lt;p>若有兩筆以上的資料有相同的 Token，&lt;code>score()&lt;/code>就會篩選出相同筆數的資料，並將這些資料印在 console 上。此時，可以透過 &lt;strong>DateTime&lt;/strong> 那行來確定填寫時間，以找到自己填寫的那筆資料。&amp;#160;&lt;a href="#fnref:7" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;li id="fn:8">
&lt;p>我對目前的部落格平台功能相當不熟悉，但就我所知提供此功能的應該不多。DataCamp Light 有提供 WordPress(不是 WordPress.com) 外掛，詳見 &lt;a href="https://github.com/datacamp/datacamp-light-wordpress">DataCamp Light Wordpress Plugin&lt;/a>。&amp;#160;&lt;a href="#fnref:8" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;li id="fn:9">
&lt;p>這裡的靜態網頁是架設在 GitHub 上，代表(1)可以任意修改網頁；(2)網頁的內容(檔案)是完全公開的。因此，相對於其他部落格平台，如 Blogger， 網站管理人的彈性相當大，而且網頁上不會出現廣告。然而，由於檔案是完全公開的，需&lt;strong>注意隱私以及版權問題&lt;/strong>。&amp;#160;&lt;a href="#fnref:9" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;li id="fn:10">
&lt;p>這是自行在 GitHub Pages 上架設部落格最困難的地方：使用者需對 Jekyll 有一定程度的理解。這同時也是我推薦 &lt;a href="https://github.com/rstudio/blogdown">blogdown&lt;/a> 的原因，其讓使用者略過理解複雜的靜態網頁產生器，而能專心在網頁的內容上。&amp;#160;&lt;a href="#fnref:10" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;li id="fn:11">
&lt;p>然&lt;code>結果查找&lt;/code>透過&lt;code>IMPORTRANGE&lt;/code>匯入的試算表只要&lt;strong>未開放共用連結&lt;/strong>，仍是安全的。這也是為何即使僅需 2 個(或甚至 1 個)試算表和 DataCamp Light 即可做到問卷回饋，但我仍使用了 3 個試算表。&lt;!-- raw HTML omitted -->(另一原因是考量 google 及 DataCamp Light 的運算資源及時間。縱使我較喜歡，也應該要用 R 語言處理資料，考量到 google 擁有較強大及穩定的運算資源，多數的運算因此交給 google 試算表，而 DataCamp Light 僅用來讀取資料。)&amp;#160;&lt;a href="#fnref:11" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;/div></description><category>Web Page</category><category>中文</category></item><item><title>Some New Features of TeXt Theme</title><link>https://yongfu.name/2018/02/24/new_md_features/</link><pubDate>Sat, 24 Feb 2018 00:00:00 +0000</pubDate><guid>https://yongfu.name/2018/02/24/new_md_features/</guid><description>&lt;p>I started customizing my blog template soon after I forked it from &lt;a href="https://github.com/kitian616/jekyll-TeXt-theme/">kitian616&lt;/a>. The downside of customizing is that once started, there&amp;rsquo;s no going back.&lt;/p>
&lt;p>I saw some new features added to the &lt;a href="https://tianqi.name/jekyll-TeXt-theme/">TeXt theme&lt;/a> recently, some of which are quite appealing to me. Since I started custimizing my blog and since I&amp;rsquo;m a layman of web page design, I have to figure out how to implement these features by myself.&lt;/p>
&lt;p>The features I implemented:&lt;/p>
&lt;ol>
&lt;li>
&lt;p>&lt;a href="https://tianqi.name/jekyll-TeXt-theme/test/2017/08/08/additional-styles.html">&lt;strong>Alert Text &amp;amp; Circled Image&lt;/strong>&lt;/a>: These two features are basically simple CSS styling. I added these two features a bit different from the original &lt;strong>TeXt theme&lt;/strong>, since we have different file structures now. But the concept is essentially the same, and I copy-and-pasted most of the code from &lt;a href="https://github.com/kitian616/jekyll-TeXt-theme/blob/master/_sass/components/_article.content.extra.scss">&lt;code>_article.content.extra.scss&lt;/code>&lt;/a> of the &lt;strong>TeXt theme&lt;/strong> to &lt;a href="https://github.com/liao961120/liao961120.github.io/blob/master/_sass/components/_article.content.scss">&lt;code>_article.content.scss&lt;/code>&lt;/a> of my blog&amp;rsquo;s source. I couldn&amp;rsquo;t figure out what some variables in &lt;code>_article.content.extra.scss&lt;/code> refered to, so I changed all of them to plain CSS without refering to other files or variables.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a href="https://tianqi.name/jekyll-TeXt-theme/test/2017/06/06/mermaid.html">&lt;strong>mermaid&lt;/strong>&lt;/a>: Implementing &lt;strong>mermaid&lt;/strong> is much more easy than the CSS things above, since I had experience with how JavaScript works on static sites (&lt;a href="https://liao961120.github.io/2018/01/27/mathjax.html">MathJax Setup&lt;/a>). But I still encountered some difficulties: I don&amp;rsquo;t know how &lt;a href="https://github.com/kitian616">Tian Qi&lt;/a> (author of &lt;strong>TeXt theme&lt;/strong>) implemented it by setting code chunck language to &lt;code>mermaid&lt;/code>. Anyway, I dealt with it by using the traditional html way&lt;sup id="fnref:1">&lt;a href="#fn:1" class="footnote-ref" role="doc-noteref">1&lt;/a>&lt;/sup>: using &lt;code>&amp;lt;div class=&amp;quot;mermaid&amp;quot;&amp;gt; ... &amp;lt;/div&amp;gt;&lt;/code> directly in markdown (see section &lt;a href="#mermaid">mermaid&lt;/a>). I put the mermaid script in &lt;a href="https://github.com/liao961120/liao961120.github.io/blob/master/_includes/utils/mathjax.html">&lt;code>mathjax.html&lt;/code>&lt;/a> instead of creating a new &lt;code>mermaid.html&lt;/code>.&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h2 id="alert-text">Alert Text&lt;/h2>
&lt;p>Success Text.
{: .success}&lt;/p>
&lt;p>Info Text.
{: .info}&lt;/p>
&lt;p>Warning Text.
{: .warning}&lt;/p>
&lt;p>Error Text.
{: .error}&lt;/p>
&lt;h3 id="code">Code&lt;/h3>
&lt;pre tabindex="0">&lt;code class="language-kramdown" data-lang="kramdown">Success Text.
{: .success}
Info Text.
{: .info}
Warning Text.
{: .warning}
Error Text.
{: .error}
&lt;/code>&lt;/pre>&lt;h3 id="kramdown-feature">kramdown Feature&lt;/h3>
&lt;p>&lt;code>{: something}&lt;/code> is a feature unique to kramdown syntax (the markdown syntax used by Jekyll). It&amp;rsquo;s very useful for making markdown more powerful. The code (e.g. &lt;code>{: .error}&lt;/code> above) works by attaching the class, &lt;code>error&lt;/code> to the paragraph right above it (e.g. the paragraph, &lt;code>Error Text.&lt;/code>, above &lt;code>{: .error}&lt;/code>. For more information, take a look at this post, &lt;a href="https://about.gitlab.com/2016/07/19/markdown-kramdown-tips-and-tricks/#classes-ids-and-attributes">Markdown Kramdown Tips &amp;amp; Tricks&lt;/a>{:target=&amp;ldquo;blank}.&lt;/p>
&lt;h2 id="circled-image">Circled Image&lt;/h2>
&lt;p>
&lt;img src="https://img.yongfu.name/assets/images/tux.png" alt="">
{:height=&amp;ldquo;80px&amp;rdquo; width=&amp;ldquo;80px&amp;rdquo;}
{:.circle}&lt;/p>
&lt;h4 id="code-1">Code&lt;/h4>
&lt;pre tabindex="0">&lt;code class="language-kramdown" data-lang="kramdown">![](path-to-image){:height=&amp;#34;80px&amp;#34; width=&amp;#34;80px&amp;#34;}
{:.circle}
&lt;/code>&lt;/pre>&lt;h2 id="mermaid">mermaid&lt;/h2>
&lt;p>&lt;a href="https://github.com/knsv/mermaid">mermaid&lt;/a> is a script language for generating charts from simple text. Below is an example of drawing a flow chart using &lt;strong>mermaid&lt;/strong>. &lt;a href="https://mermaidjs.github.io">Documentation for Mermaid&lt;/a>{: target=&amp;quot;_blank&amp;rdquo;}.&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;h4 id="code-2">Code&lt;/h4>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-html" data-lang="html">&lt;span style="display:flex;">&lt;span>&amp;lt;&lt;span style="color:#f92672">div&lt;/span> &lt;span style="color:#a6e22e">class&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;mermaid&amp;#34;&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>graph TD;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> A(text)--&amp;gt;B(rounded);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> A--&amp;gt;C;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> B--&amp;gt;D;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> C--&amp;gt;D;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&amp;lt;/&lt;span style="color:#f92672">div&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="notes">Notes&lt;/h2>
&lt;div class="footnotes" role="doc-endnotes">
&lt;hr>
&lt;ol>
&lt;li id="fn:1">
&lt;p>See the section, &lt;strong>Simple usage on a web page&lt;/strong>, in &lt;a href="https://mermaidjs.github.io/usage.html">Usage&lt;/a> of mermaid documentation.&amp;#160;&lt;a href="#fnref:1" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;/div></description><category>markdown</category><category>Web Page</category></item><item><title>MathJax Setup</title><link>https://yongfu.name/2018/01/27/mathjax/</link><pubDate>Sat, 27 Jan 2018 00:00:00 +0000</pubDate><guid>https://yongfu.name/2018/01/27/mathjax/</guid><description>&lt;p>THIS POST IS OUTDATED&lt;/p>
&lt;hr>
&lt;p>MathJax is a JavaScript display engine for mathematics that works in all browsers. By including MathJax support on the website, LaTeX mathematical expressions are rendered as pretty mathematical equations.&lt;/p>
&lt;h2 id="add-mathjax-support">Add MathJax Support&lt;/h2>
&lt;p>Add the code below to the &lt;code>&amp;lt;head&amp;gt; ... &amp;lt;/head&amp;gt;&lt;/code> region of every page (&lt;code>.html&lt;/code>) to enable MathJax support. The code below allows supporting &lt;code>$&lt;/code> and &lt;code>$$&lt;/code> in Markdown.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-html" data-lang="html">&lt;span style="display:flex;">&lt;span>&amp;lt;&lt;span style="color:#f92672">script&lt;/span> &lt;span style="color:#a6e22e">type&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;text/x-mathjax-config&amp;#34;&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">MathJax&lt;/span>.&lt;span style="color:#a6e22e">Hub&lt;/span>.&lt;span style="color:#a6e22e">Config&lt;/span>({
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">tex2jax&lt;/span>&lt;span style="color:#f92672">:&lt;/span> {&lt;span style="color:#a6e22e">inlineMath&lt;/span>&lt;span style="color:#f92672">:&lt;/span> [[&lt;span style="color:#e6db74">&amp;#39;$&amp;#39;&lt;/span>,&lt;span style="color:#e6db74">&amp;#39;$&amp;#39;&lt;/span>], [&lt;span style="color:#e6db74">&amp;#39;\\(&amp;#39;&lt;/span>,&lt;span style="color:#e6db74">&amp;#39;\\)&amp;#39;&lt;/span>]]}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&amp;lt;/&lt;span style="color:#f92672">script&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&amp;lt;&lt;span style="color:#f92672">script&lt;/span> &lt;span style="color:#a6e22e">type&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;text/javascript&amp;#34;&lt;/span> &lt;span style="color:#a6e22e">async&lt;/span> &lt;span style="color:#a6e22e">src&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML&amp;#34;&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&amp;lt;/&lt;span style="color:#f92672">script&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="equation-autonumber">Equation autoNumber&lt;/h2>
&lt;p>Add the code below to header if you want equation auto-numbering.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-html" data-lang="html">&lt;span style="display:flex;">&lt;span>&amp;lt;&lt;span style="color:#f92672">script&lt;/span> &lt;span style="color:#a6e22e">type&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;text/x-mathjax-config&amp;#34;&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">MathJax&lt;/span>.&lt;span style="color:#a6e22e">Hub&lt;/span>.&lt;span style="color:#a6e22e">Config&lt;/span>({
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">TeX&lt;/span>&lt;span style="color:#f92672">:&lt;/span> { &lt;span style="color:#a6e22e">equationNumbers&lt;/span>&lt;span style="color:#f92672">:&lt;/span> { &lt;span style="color:#a6e22e">autoNumber&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#e6db74">&amp;#34;all&amp;#34;&lt;/span> } }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&amp;lt;/&lt;span style="color:#f92672">script&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="escape-numbering">Escape Numbering&lt;/h3>
&lt;p>Add &lt;code>\notag&lt;/code> to the equations to escape auto-numbering, e.g.&lt;/p>
&lt;h4 id="without-notag">Without &lt;code>\notag&lt;/code>&lt;/h4>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-tex" data-lang="tex">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">$$&lt;/span>\frac{d}{d\,t} N_{i}&lt;span style="color:#f92672">=&lt;/span> b_{i} N_{i}\left&lt;span style="color:#f92672">[&lt;/span>C S\right&lt;span style="color:#f92672">]&lt;/span>_{i} &lt;span style="color:#f92672">-&lt;/span> d_{i} N_{i}&lt;span style="color:#e6db74">$$&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>gives&lt;/p>
&lt;p>&lt;code>$$\frac{d}{d\,t} \,N_{i}= b_{i} N_{i}\left[C S\right]_{i} - d_{i} N_{i}$$&lt;/code>&lt;/p>
&lt;h4 id="with-notag">With &lt;code>\notag&lt;/code>&lt;/h4>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-tex" data-lang="tex">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">$$&lt;/span>\frac{d}{d\,t} N_{i}&lt;span style="color:#f92672">=&lt;/span> b_{i} N_{i}\left&lt;span style="color:#f92672">[&lt;/span>C S\right&lt;span style="color:#f92672">]&lt;/span>_{i} &lt;span style="color:#f92672">-&lt;/span> d_{i} N_{i} \notag&lt;span style="color:#e6db74">$$&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>gives&lt;/p>
&lt;p>&lt;code>$$\frac{d}{d\,t} N_{i}= b_{i} N_{i}\left[C S\right]_{i} - d_{i} N_{i} \notag$$&lt;/code>&lt;/p>
&lt;h3 id="equation-reference">Equation Reference&lt;/h3>
&lt;p>Add &lt;code>\label{eq:name}&lt;/code> to equation to give identifier. Use &lt;code>$\eqref{eq:name}$&lt;/code> to reference the labled equation&lt;sup id="fnref:1">&lt;a href="#fn:1" class="footnote-ref" role="doc-noteref">1&lt;/a>&lt;/sup>.&lt;/p>
&lt;h4 id="example">Example&lt;/h4>
&lt;p>I added &lt;code>\label{eq:N}&lt;/code> at the end of the equation:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-tex" data-lang="tex">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">$$&lt;/span> \frac{d}{d\,t} N_{&lt;span style="color:#ae81ff">1&lt;/span>} &lt;span style="color:#f92672">=&lt;/span>\left&lt;span style="color:#f92672">[&lt;/span> b_{&lt;span style="color:#ae81ff">1&lt;/span>} N_{&lt;span style="color:#ae81ff">1&lt;/span>}\,\left&lt;span style="color:#f92672">(&lt;/span> S_{&lt;span style="color:#ae81ff">2&lt;/span>}\,c_{&lt;span style="color:#ae81ff">12&lt;/span>}&lt;span style="color:#f92672">+&lt;/span>S_{&lt;span style="color:#ae81ff">1&lt;/span>}\,c_{&lt;span style="color:#ae81ff">11&lt;/span>}\right&lt;span style="color:#f92672">)-&lt;/span> d_{&lt;span style="color:#ae81ff">1&lt;/span>} N_{&lt;span style="color:#ae81ff">1&lt;/span>}\, \right&lt;span style="color:#f92672">]&lt;/span> \label{eq:N}&lt;span style="color:#e6db74">$$&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>$$\frac{d}{d\,t} N_{1} =\left[ b_{1} N_{1}\,\left( S_{2}\,c_{12}+S_{1}\,c_{11}\right)- d_{1} N_{1}\, \right] \label{eq:N}$$&lt;/code>&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;p>Now, adding &lt;code>$\eqref{eq:N}$&lt;/code> in the text, e.g,&lt;/p>
&lt;pre tabindex="0">&lt;code>See $\eqref{eq:N}$ for details.
&lt;/code>&lt;/pre>&lt;p>, gives &lt;strong>See $\eqref{eq:N}$ for details.&lt;/strong>&lt;/p>
&lt;h2 id="github-page-support">GitHub Page Support&lt;/h2>
&lt;p>You can take a look at MathJax support of my page &lt;a href="https://github.com/liao961120/liao961120.github.io/blob/master/_includes/utils/">here&lt;/a>, it&amp;rsquo;s in the file &lt;code>mathjax.html&lt;/code>.&lt;/p>
&lt;p>&lt;code>mathjax.html&lt;/code> contains two part. The first starts with
&lt;code>{% raw %}{% if site.mathjax == true or page.mathjax == true %}{% endraw %}&lt;/code>, and the code below it is the same as the code in the section, &lt;a href="#add-mathjax-support">Add MathJax Support&lt;/a>.&lt;/p>
&lt;p>The second starts with &lt;code>{% raw %}{% if page.mathjax2 == true %}{% endraw %}&lt;/code>, and the code below it is the same as the code in the section, &lt;a href="#equation-autonumber">Equation autoNumber&lt;/a>.&lt;/p>
&lt;p>Note the variables &lt;code>mathjax&lt;/code> and &lt;code>mathjax2&lt;/code>&lt;sup id="fnref:2">&lt;a href="#fn:2" class="footnote-ref" role="doc-noteref">2&lt;/a>&lt;/sup> in the liquid tags. You can set them globally&lt;sup id="fnref:3">&lt;a href="#fn:3" class="footnote-ref" role="doc-noteref">3&lt;/a>&lt;/sup> in &lt;code>_config.yml&lt;/code>, or individually in the yaml header of each post/page. For example, I set the code below in &lt;code>_config.yml&lt;/code>.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">mathjax&lt;/span>: &lt;span style="color:#66d9ef">true&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">mathjax2&lt;/span>: &lt;span style="color:#66d9ef">false&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>This allows mathjax support &lt;strong>without&lt;/strong> equation auto-numbering to be the default setting of my site. When I want auto-numbering for some post (or page), I can set &lt;code>mathjax2: true&lt;/code> in the yaml header of the post.&lt;/p>
&lt;h3 id="some-additional-warnings">Some Additional Warnings&lt;/h3>
&lt;p>When I was typing this post, I found that &lt;strong>GitHub Pages&lt;/strong> may have trouble rendering pages containing &lt;strong>Latex&lt;/strong>. This is because &lt;strong>GitHub Pages&lt;/strong> sometimes confuses several curly braces (&lt;code>{&lt;/code>) written together as Jekyll &lt;strong>liquid tags&lt;/strong>, which could cause page build failure. You can avoid this by not using too complicated Latex syntax, especially those with many &lt;code>{&lt;/code> (or &lt;code>}&lt;/code>) connected together. If you want to explicitely include &lt;strong>liquid tags&lt;/strong> in your posts, look &lt;a href="https://liao961120.github.io/Markdown_Features.html">here&lt;/a> for more details.&lt;/p>
&lt;div class="footnotes" role="doc-endnotes">
&lt;hr>
&lt;ol>
&lt;li id="fn:1">
&lt;p>Note that &lt;code>\label&lt;/code> &amp;amp; &lt;code>\notag&lt;/code> &lt;strong>can&amp;rsquo;t&lt;/strong> be used together (You can&amp;rsquo;t label a numbering-escaped equation).&amp;#160;&lt;a href="#fnref:1" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;li id="fn:2">
&lt;p>Which is in &lt;code>site.mathjax&lt;/code>, &lt;code>page.mathjax&lt;/code>,and &lt;code>page.mathjax2&lt;/code>, and are all set to &lt;code>true&lt;/code>.&amp;#160;&lt;a href="#fnref:2" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;li id="fn:3">
&lt;p>The &lt;a href="https://github.com/liao961120/liao961120.github.io/blob/master/_layouts/blog-base.html">base template&lt;/a> of my blog imports scripts from &lt;code>mathjax.html&lt;/code>(line 18), so the whole site supports mathjax (as long as the page uses the template of my blog).&amp;#160;&lt;a href="#fnref:3" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;/div></description><category>Web Page</category><category>markdown</category></item></channel></rss>